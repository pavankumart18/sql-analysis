[
  {
    "sql_id": "S000001",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000002",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000003",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000004",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000005",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000006",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000007",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000008",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000009",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000010",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000011",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-12 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000012",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-13 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000013",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000014",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-17 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000015",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000016",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000017",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000018",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-23 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-30 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000019",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-31 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000020",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-01 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000021",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-28 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000022",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000023",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-31 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000024",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-02 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000025",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-03 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000026",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-08 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000027",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-17 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000028",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000029",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-13 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000030",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-21 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000031",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e000031"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000031 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e000031 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-15 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000031 LIMIT 500;"
  },
  {
    "sql_id": "S000032",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-16 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000033",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000034",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-28 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000035",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000036",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-23 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-01 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000037",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000038",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-04 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000039",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-05 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000040",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-29 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000041",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000042",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-05 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000043",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-12 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000044",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-14 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000045",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-09 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000046",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000047",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-26 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000048",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000049",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-27 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000050",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-22 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-29 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000051",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-01 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000052",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-04 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000053",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-28 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000054",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-06 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000055",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000056",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-02 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000057",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-03 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000058",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-04 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-11 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000059",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000060",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-06 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000061",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-16 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000062",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000063",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000064",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-12 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000065",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000066",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000067",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000068",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000069",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-28 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000070",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-23 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-30 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000071",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-01 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000072",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-02 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000073",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000074",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-27 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000075",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000076",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000077",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-02 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000078",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000079",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-14 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000080",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-15 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000081",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-09 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000082",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000083",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000084",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-15 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000085",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e000085"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000085 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e000085 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-16 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000085 LIMIT 500;"
  },
  {
    "sql_id": "S000086",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000087",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000088",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e000088"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000088 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e000088 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-22 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-29 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000088 LIMIT 500;"
  },
  {
    "sql_id": "S000089",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e000089"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000089 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e000089 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-30 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-30 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000089 LIMIT 500;"
  },
  {
    "sql_id": "S000090",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-31 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000091",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-02 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-01 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000092",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-28 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000093",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-06 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000094",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000095",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-08 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000096",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000097",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-04 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-11 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000098",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-05 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000099",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000100",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e000100"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000100 AS         -- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM...",
    "sql_full": "CREATE TEMP TABLE tmp_e000100 AS\n        -- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-14 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000100 LIMIT 500;"
  },
  {
    "sql_id": "S000101",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-16 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000102",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e000102"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000102 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e000102 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-09 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000102 LIMIT 500;"
  },
  {
    "sql_id": "S000103",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000104",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-12 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000105",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000106",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-21 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000107",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000108",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000109",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-26 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000110",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e000110"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000110 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e000110 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000110 LIMIT 500;"
  },
  {
    "sql_id": "S000111",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000112",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-03 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000113",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000114",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-29 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000115",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000116",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e000116"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000116 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e000116 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000116 LIMIT 500;"
  },
  {
    "sql_id": "S000117",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000118",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-11 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000119",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-05 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000120",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000121",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-09 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000122",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000123",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000124",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-12 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000125",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000126",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-16 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000127",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000128",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e000128"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000128 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e000128 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000128 LIMIT 500;"
  },
  {
    "sql_id": "S000129",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-23 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-30 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000130",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-31 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000131",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000132",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e000132"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000132 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e000132 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-27 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;\n        SELECT * FROM tmp_e000132 LIMIT 500;"
  },
  {
    "sql_id": "S000133",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000134",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-08 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000135",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-03 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000136",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-06 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000137",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e000137"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000137 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e000137 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-15 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-14 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000137 LIMIT 500;"
  },
  {
    "sql_id": "S000138",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-08 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000139",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000140",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-13 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000141",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-15 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000142",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000143",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-17 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000144",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000145",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000146",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-30 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-29 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000147",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-30 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000148",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-31 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000149",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-04 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000150",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-28 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000151",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000152",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-30 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000153",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-31 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000154",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000155",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-12 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-11 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000156",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000157",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e000157"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000157 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e000157 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-12 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000157 LIMIT 500;"
  },
  {
    "sql_id": "S000158",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-13 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000159",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-21 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000160",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-17 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000161",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000162",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-26 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000163",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000164",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000165",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000166",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-27 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000167",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-28 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000168",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-29 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000169",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-02 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000170",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e000170"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000170 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e000170 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-03 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000170 LIMIT 500;"
  },
  {
    "sql_id": "S000171",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-11 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000172",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-08 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000173",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-16 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000174",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000175",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000176",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000177",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-21 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000178",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-22 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000179",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-23 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000180",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-17 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000181",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000182",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e000182"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000182 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e000182 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-19 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-26 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000182 LIMIT 500;"
  },
  {
    "sql_id": "S000183",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-29 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000184",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-30 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000185",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-01 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000186",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000187",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000188",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000189",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-31 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000190",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000191",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e000191"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000191 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e000191 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-11 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000191 LIMIT 500;"
  },
  {
    "sql_id": "S000192",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-05 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000193",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-14 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000194",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-09 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000195",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-12 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000196",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000197",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-21 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000198",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-15 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000199",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000200",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-29 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000201",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-29 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000202",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-31 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-30 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000203",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000204",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-27 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000205",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-28 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000206",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000207",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e000207"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000207 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e000207 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-03 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000207 LIMIT 500;"
  },
  {
    "sql_id": "S000208",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-11 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000209",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000210",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e000210"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000210 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e000210 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000210 LIMIT 500;"
  },
  {
    "sql_id": "S000211",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000212",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-21 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000213",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000214",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000215",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-26 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000216",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000217",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-28 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000218",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-30 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000219",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-31 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000220",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-02 00:00:00' AND t.purchased_at <  TIMESTAMP '2025-01-01 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000221",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000222",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000223",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000224",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000225",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000226",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-04 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-11 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000227",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-05 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000228",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000229",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-12 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000230",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-16 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000231",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000232",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000233",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-26 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000234",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000235",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-31 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000236",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000237",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-30 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000238",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-31 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000239",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-09 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000240",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000241",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000242",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000243",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-16 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000244",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000245",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000246",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-28 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000247",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000247"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000247 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e000247 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-23 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-01 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000247 LIMIT 500;"
  },
  {
    "sql_id": "S000248",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000249",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000250",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000251",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000252",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000253",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-08 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000254",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-13 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000255",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-21 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000256",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000257",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-26 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000258",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000259",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-27 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000260",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-03 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000261",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-05 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000262",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-05 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000263",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-06 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000264",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-17 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000265",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000266",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000267",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000267"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000267 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e000267 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000267 LIMIT 500;"
  },
  {
    "sql_id": "S000268",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-16 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000269",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000270",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000271",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-19 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-26 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000272",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000273",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-30 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000274",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-01 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000275",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000276",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000277",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000278",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000279",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-02 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000280",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000281",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-14 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000282",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000282"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000282 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e000282 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-15 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000282 LIMIT 500;"
  },
  {
    "sql_id": "S000283",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000284",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000285",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-22 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000286",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-16 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000287",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000288",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-28 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000289",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-23 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-30 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000290",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-01 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000291",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000292",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000292"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000292 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e000292 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-29 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000292 LIMIT 500;"
  },
  {
    "sql_id": "S000293",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000294",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000295",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-04 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-11 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000296",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-05 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000297",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-06 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000298",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-08 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000299",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000300",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000301",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000302",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-21 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000303",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-15 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000304",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000305",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-29 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000306",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-30 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-29 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000307",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000308",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000308"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000308 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e000308 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000308 LIMIT 500;"
  },
  {
    "sql_id": "S000309",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000309"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000309 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e000309 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-06 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000309 LIMIT 500;"
  },
  {
    "sql_id": "S000310",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-02 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000311",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-11 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000312",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000313",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-17 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000314",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000315",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000315"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000315 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e000315 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-19 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000315 LIMIT 500;"
  },
  {
    "sql_id": "S000316",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000317",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-23 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000318",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000319",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000319"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000319 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e000319 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-27 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000319 LIMIT 500;"
  },
  {
    "sql_id": "S000320",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000320"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000320 AS         -- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(d...",
    "sql_full": "CREATE TEMP TABLE tmp_e000320 AS\n        -- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-01 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000320 LIMIT 500;"
  },
  {
    "sql_id": "S000321",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000322",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000323",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000324",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-08 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000325",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000325"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000325 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e000325 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000325 LIMIT 500;"
  },
  {
    "sql_id": "S000326",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000327",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-06 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000328",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-15 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-14 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000329",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000330",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000330"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000330 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e000330 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-09 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000330 LIMIT 500;"
  },
  {
    "sql_id": "S000331",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000332",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-13 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000333",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-21 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000334",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000335",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-17 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000336",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000336"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000336 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e000336 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-29 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000336 LIMIT 500;"
  },
  {
    "sql_id": "S000337",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-31 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-30 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000338",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-31 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000339",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-27 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000340",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000341",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-06 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000342",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000343",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-03 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000344",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000345",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000346",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000347",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-13 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000348",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-21 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000349",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-16 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000350",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000351",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000352",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000353",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000354",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-01 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000355",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000355"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000355 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e000355 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000355 LIMIT 500;"
  },
  {
    "sql_id": "S000356",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-04 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000357",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000358",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-03 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000359",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-12 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000360",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-14 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000361",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-08 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000362",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000363",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000364",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000365",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-22 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000366",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000367",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000367"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000367 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e000367 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-29 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-29 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000367 LIMIT 500;"
  },
  {
    "sql_id": "S000368",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-30 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000369",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-31 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000370",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-02 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-01 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000371",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000372",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000372"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000372 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e000372 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;\n        SELECT * FROM tmp_e000372 LIMIT 500;"
  },
  {
    "sql_id": "S000373",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-29 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000374",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000375",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000376",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000377",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-14 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000378",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-08 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000379",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-12 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000380",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-16 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000381",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-19 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-26 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000382",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000383",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-30 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-29 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000384",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000384"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000384 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e000384 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-23 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-30 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000384 LIMIT 500;"
  },
  {
    "sql_id": "S000385",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-28 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000386",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-29 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000387",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000387"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000387 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e000387 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-03 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000387 LIMIT 500;"
  },
  {
    "sql_id": "S000388",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-06 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000389",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000389"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000389 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e000389 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-14 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000389 LIMIT 500;"
  },
  {
    "sql_id": "S000390",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000391",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000392",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-12 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000393",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-13 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000394",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-15 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000395",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000395"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000395 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e000395 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-23 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;\n        SELECT * FROM tmp_e000395 LIMIT 500;"
  },
  {
    "sql_id": "S000396",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000397",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000397"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000397 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e000397 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-26 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000397 LIMIT 500;"
  },
  {
    "sql_id": "S000398",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000399",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-31 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000400",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2025-01-01 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000401",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000402",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000403",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000404",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000405",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000406",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000407",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000408",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-11 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000409",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000410",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000411",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000412",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000413",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-16 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000414",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000415",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-26 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000416",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-23 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-30 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000417",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-31 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000418",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-02 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-01 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000419",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-05 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000420",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-02-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000421",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-09 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000422",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-02-02 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000423",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans",
      "tmp_e000423"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e000423 AS         WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000423 AS\n        WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;\n        SELECT * FROM tmp_e000423 LIMIT 500;"
  },
  {
    "sql_id": "S000424",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000425",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-02-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-14 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000426",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-02-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000427",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-02-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000428",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-02-13 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000429",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-22 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-21 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000430",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-02-15 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000431",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-02-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000432",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000433",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-02-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000434",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-02-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000435",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-30 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-29 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000436",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-02-23 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-01 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000437",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-02-04 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000438",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-02-05 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000439",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-02-29 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000440",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-03-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000441",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-03-03 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000442",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-03-05 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000443",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-03-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000444",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-03-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000445",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-02-19 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000446",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-02-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-21 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000447",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-02-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000448",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-03-16 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000449",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000450",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-03-04 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000451",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-03-05 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000452",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-03-30 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000453",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-05 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000454",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-03-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000455",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans",
      "tmp_e000455"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e000455 AS         WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000455 AS\n        WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-14 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY b.event_week, b.seat_section;\n        SELECT * FROM tmp_e000455 LIMIT 500;"
  },
  {
    "sql_id": "S000456",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans",
      "tmp_e000456"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e000456 AS         WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000456 AS\n        WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;\n        SELECT * FROM tmp_e000456 LIMIT 500;"
  },
  {
    "sql_id": "S000457",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-03-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000458",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000459",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000460",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-19 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-26 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000461",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans",
      "tmp_e000461"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e000461 AS         WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000461 AS\n        WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-23 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-30 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;\n        SELECT * FROM tmp_e000461 LIMIT 500;"
  },
  {
    "sql_id": "S000462",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000463",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-08 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000464",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-05-04 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-11 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000465",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-14 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000466",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-05-08 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000467",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-17 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000468",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-05-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-21 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000469",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-05-15 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000470",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-05-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000471",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-05-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-29 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000472",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-05-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-31 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000473",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans",
      "tmp_e000473"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e000473 AS         WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000473 AS\n        WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-05-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-01 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;\n        SELECT * FROM tmp_e000473 LIMIT 500;"
  },
  {
    "sql_id": "S000474",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans",
      "tmp_e000474"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e000474 AS         WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000474 AS\n        WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-06-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;\n        SELECT * FROM tmp_e000474 LIMIT 500;"
  },
  {
    "sql_id": "S000475",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-05-31 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000476",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-06-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000477",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-06-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-11 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000478",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-06-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000479",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-06-06 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000480",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-06-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000481",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-05-19 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000482",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-05-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000483",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-06-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-21 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000484",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-06-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000485",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-06-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000486",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-06-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-26 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000487",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-05-28 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000488",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-06-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000489",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000490",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-06-27 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000491",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-06-28 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000492",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000493",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000494",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-06-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-11 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000495",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-05 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000496",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000497",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000498",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-12 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000499",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-13 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000500",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000501",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000502",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-08-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000503",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-30 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000504",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-08 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000505",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-09 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000506",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans",
      "tmp_e000506"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e000506 AS         WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000506 AS\n        WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;\n        SELECT * FROM tmp_e000506 LIMIT 500;"
  },
  {
    "sql_id": "S000507",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-08-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000508",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-08-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000509",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-15 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-14 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000510",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-08-08 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000511",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans",
      "tmp_e000511"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e000511 AS         WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000511 AS\n        WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-17 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;\n        SELECT * FROM tmp_e000511 LIMIT 500;"
  },
  {
    "sql_id": "S000512",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000513",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000514",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-08-13 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000515",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-08-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-21 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000516",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-08-15 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000517",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-08-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000518",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-08-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000519",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans",
      "tmp_e000519"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e000519 AS         WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000519 AS\n        WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-29 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;\n        SELECT * FROM tmp_e000519 LIMIT 500;"
  },
  {
    "sql_id": "S000520",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-08-23 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-30 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000521",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-08-04 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000522",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000523",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-04 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-11 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000524",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-08-13 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000525",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000526",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000527",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000528",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000529",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-08-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000530",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-17 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000531",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-19 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-26 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000532",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000533",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-02 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000534",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000535",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-04 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000536",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-28 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000537",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-08 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000538",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-10-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000539",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-10-04 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-11 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000540",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-10-05 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000541",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans",
      "tmp_e000541"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e000541 AS         WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000541 AS\n        WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-14 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;\n        SELECT * FROM tmp_e000541 LIMIT 500;"
  },
  {
    "sql_id": "S000542",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-10-12 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000543",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-10-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000544",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000545",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-10-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-26 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000546",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-10-23 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-30 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000547",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-10-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-31 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000548",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-10-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000549",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000550",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000551",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000552",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-10-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000553",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-14 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000554",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-10-16 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000555",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-09 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000556",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-21 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000557",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-15 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000558",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000559",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-19 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-26 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000560",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000561",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-10-30 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-29 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000562",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000563",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-27 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000564",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-05 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000565",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-29 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000566",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-30 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000567",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-12-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000568",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-12-03 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000569",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-11 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000570",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans",
      "tmp_e000570"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e000570 AS         WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000570 AS\n        WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-12-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-14 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY b.event_week, b.seat_section;\n        SELECT * FROM tmp_e000570 LIMIT 500;"
  },
  {
    "sql_id": "S000571",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-15 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000572",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-12-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000573",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-12-12 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000574",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-12-13 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000575",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000576",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000577",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-12-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-26 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000578",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-12-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000579",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-28 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000580",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-12-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2025-01-01 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000581",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-01-01 00:00:00' AND event_ts <  TIMESTAMP '2024-01-04 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000582",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-01-03 00:00:00' AND event_ts <  TIMESTAMP '2024-01-10 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000583",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-01-01 00:00:00' AND event_ts <  TIMESTAMP '2024-01-11 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000584",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-01-05 00:00:00' AND event_ts <  TIMESTAMP '2024-01-12 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000585",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-01-17 00:00:00' AND event_ts <  TIMESTAMP '2024-01-24 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000586",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-01-19 00:00:00' AND event_ts <  TIMESTAMP '2024-01-26 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000587",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-01-30 00:00:00' AND event_ts <  TIMESTAMP '2024-02-06 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000588",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-01-09 00:00:00' AND event_ts <  TIMESTAMP '2024-02-08 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000589",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-02-08 00:00:00' AND event_ts <  TIMESTAMP '2024-02-15 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000590",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-02-01 00:00:00' AND event_ts <  TIMESTAMP '2024-02-20 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000591",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-02-01 00:00:00' AND event_ts <  TIMESTAMP '2024-02-21 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000592",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-02-15 00:00:00' AND event_ts <  TIMESTAMP '2024-02-22 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000593",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-02-21 00:00:00' AND event_ts <  TIMESTAMP '2024-02-28 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000594",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-02-22 00:00:00' AND event_ts <  TIMESTAMP '2024-02-29 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000595",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-02-04 00:00:00' AND event_ts <  TIMESTAMP '2024-03-05 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000596",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-03-01 00:00:00' AND event_ts <  TIMESTAMP '2024-03-06 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000597",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-02-06 00:00:00' AND event_ts <  TIMESTAMP '2024-03-07 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000598",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-02-11 00:00:00' AND event_ts <  TIMESTAMP '2024-03-12 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000599",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-03-01 00:00:00' AND event_ts <  TIMESTAMP '2024-03-13 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000600",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-02-14 00:00:00' AND event_ts <  TIMESTAMP '2024-03-15 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000601",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-02-15 00:00:00' AND event_ts <  TIMESTAMP '2024-03-16 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000602",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-03-12 00:00:00' AND event_ts <  TIMESTAMP '2024-03-19 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000603",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-03-14 00:00:00' AND event_ts <  TIMESTAMP '2024-03-21 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000604",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-02-22 00:00:00' AND event_ts <  TIMESTAMP '2024-03-23 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000605",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-03-01 00:00:00' AND event_ts <  TIMESTAMP '2024-03-27 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000606",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-02-27 00:00:00' AND event_ts <  TIMESTAMP '2024-03-28 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000607",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-03-26 00:00:00' AND event_ts <  TIMESTAMP '2024-04-02 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000608",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-03-29 00:00:00' AND event_ts <  TIMESTAMP '2024-04-05 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000609",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-04-03 00:00:00' AND event_ts <  TIMESTAMP '2024-04-10 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000610",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-04-04 00:00:00' AND event_ts <  TIMESTAMP '2024-04-11 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000611",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-04-09 00:00:00' AND event_ts <  TIMESTAMP '2024-04-16 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000612",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-04-11 00:00:00' AND event_ts <  TIMESTAMP '2024-04-18 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000613",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-04-17 00:00:00' AND event_ts <  TIMESTAMP '2024-04-24 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000614",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-04-19 00:00:00' AND event_ts <  TIMESTAMP '2024-04-26 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000615",
    "tables": [
      "raw_digital_events",
      "tmp_e000615"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e000615 AS         WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,        ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000615 AS\n        WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-03-29 00:00:00' AND event_ts <  TIMESTAMP '2024-04-28 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;\n        SELECT * FROM tmp_e000615 LIMIT 500;"
  },
  {
    "sql_id": "S000616",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-04-07 00:00:00' AND event_ts <  TIMESTAMP '2024-05-07 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000617",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-05-07 00:00:00' AND event_ts <  TIMESTAMP '2024-05-14 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000618",
    "tables": [
      "raw_digital_events",
      "tmp_e000618"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e000618 AS         WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,        ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000618 AS\n        WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-04-15 00:00:00' AND event_ts <  TIMESTAMP '2024-05-15 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;\n        SELECT * FROM tmp_e000618 LIMIT 500;"
  },
  {
    "sql_id": "S000619",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-04-16 00:00:00' AND event_ts <  TIMESTAMP '2024-05-16 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000620",
    "tables": [
      "raw_digital_events",
      "tmp_e000620"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e000620 AS         WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,        ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000620 AS\n        WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-05-13 00:00:00' AND event_ts <  TIMESTAMP '2024-05-20 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;\n        SELECT * FROM tmp_e000620 LIMIT 500;"
  },
  {
    "sql_id": "S000621",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-05-29 00:00:00' AND event_ts <  TIMESTAMP '2024-06-05 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000622",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-05-31 00:00:00' AND event_ts <  TIMESTAMP '2024-06-07 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000623",
    "tables": [
      "raw_digital_events",
      "tmp_e000623"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e000623 AS         -- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN...",
    "sql_full": "CREATE TEMP TABLE tmp_e000623 AS\n        -- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-06-01 00:00:00' AND event_ts <  TIMESTAMP '2024-06-08 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;\n        SELECT * FROM tmp_e000623 LIMIT 500;"
  },
  {
    "sql_id": "S000624",
    "tables": [
      "raw_digital_events",
      "tmp_e000624"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e000624 AS         WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,        ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000624 AS\n        WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-06-04 00:00:00' AND event_ts <  TIMESTAMP '2024-06-11 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;\n        SELECT * FROM tmp_e000624 LIMIT 500;"
  },
  {
    "sql_id": "S000625",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-06-01 00:00:00' AND event_ts <  TIMESTAMP '2024-06-13 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000626",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-06-13 00:00:00' AND event_ts <  TIMESTAMP '2024-06-20 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000627",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-05-27 00:00:00' AND event_ts <  TIMESTAMP '2024-06-26 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000628",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-06-20 00:00:00' AND event_ts <  TIMESTAMP '2024-06-27 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000629",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-05-30 00:00:00' AND event_ts <  TIMESTAMP '2024-06-29 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000630",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-06-02 00:00:00' AND event_ts <  TIMESTAMP '2024-07-02 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000631",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-06-03 00:00:00' AND event_ts <  TIMESTAMP '2024-07-03 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000632",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-06-27 00:00:00' AND event_ts <  TIMESTAMP '2024-07-04 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000633",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-07-04 00:00:00' AND event_ts <  TIMESTAMP '2024-07-11 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000634",
    "tables": [
      "raw_digital_events",
      "tmp_e000634"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e000634 AS         WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,        ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000634 AS\n        WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-06-12 00:00:00' AND event_ts <  TIMESTAMP '2024-07-12 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;\n        SELECT * FROM tmp_e000634 LIMIT 500;"
  },
  {
    "sql_id": "S000635",
    "tables": [
      "raw_digital_events",
      "tmp_e000635"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e000635 AS         WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,        ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000635 AS\n        WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-07-06 00:00:00' AND event_ts <  TIMESTAMP '2024-07-13 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;\n        SELECT * FROM tmp_e000635 LIMIT 500;"
  },
  {
    "sql_id": "S000636",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-07-10 00:00:00' AND event_ts <  TIMESTAMP '2024-07-17 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000637",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-07-11 00:00:00' AND event_ts <  TIMESTAMP '2024-07-18 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000638",
    "tables": [
      "raw_digital_events",
      "tmp_e000638"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e000638 AS         WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,        ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000638 AS\n        WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-07-12 00:00:00' AND event_ts <  TIMESTAMP '2024-07-19 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;\n        SELECT * FROM tmp_e000638 LIMIT 500;"
  },
  {
    "sql_id": "S000639",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-07-17 00:00:00' AND event_ts <  TIMESTAMP '2024-07-24 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000640",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-06-25 00:00:00' AND event_ts <  TIMESTAMP '2024-07-25 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000641",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-06-26 00:00:00' AND event_ts <  TIMESTAMP '2024-07-26 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000642",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-06-27 00:00:00' AND event_ts <  TIMESTAMP '2024-07-27 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000643",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-07-23 00:00:00' AND event_ts <  TIMESTAMP '2024-07-30 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000644",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-07-24 00:00:00' AND event_ts <  TIMESTAMP '2024-07-31 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000645",
    "tables": [
      "raw_digital_events",
      "tmp_e000645"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e000645 AS         WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,        ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000645 AS\n        WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-07-30 00:00:00' AND event_ts <  TIMESTAMP '2024-08-06 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;\n        SELECT * FROM tmp_e000645 LIMIT 500;"
  },
  {
    "sql_id": "S000646",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-07-31 00:00:00' AND event_ts <  TIMESTAMP '2024-08-07 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000647",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-07-10 00:00:00' AND event_ts <  TIMESTAMP '2024-08-09 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000648",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-07-20 00:00:00' AND event_ts <  TIMESTAMP '2024-08-19 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000649",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-08-01 00:00:00' AND event_ts <  TIMESTAMP '2024-08-20 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000650",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-08-01 00:00:00' AND event_ts <  TIMESTAMP '2024-08-24 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000651",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-08-21 00:00:00' AND event_ts <  TIMESTAMP '2024-08-28 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000652",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-08-22 00:00:00' AND event_ts <  TIMESTAMP '2024-08-29 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000653",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-08-01 00:00:00' AND event_ts <  TIMESTAMP '2024-08-30 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000654",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-08-27 00:00:00' AND event_ts <  TIMESTAMP '2024-09-03 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000655",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-08-29 00:00:00' AND event_ts <  TIMESTAMP '2024-09-05 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000656",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-08-07 00:00:00' AND event_ts <  TIMESTAMP '2024-09-06 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000657",
    "tables": [
      "raw_digital_events",
      "tmp_e000657"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e000657 AS         WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,        ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000657 AS\n        WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-08-31 00:00:00' AND event_ts <  TIMESTAMP '2024-09-07 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;\n        SELECT * FROM tmp_e000657 LIMIT 500;"
  },
  {
    "sql_id": "S000658",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-04 00:00:00' AND event_ts <  TIMESTAMP '2024-09-11 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000659",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-01 00:00:00' AND event_ts <  TIMESTAMP '2024-09-12 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000660",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-10 00:00:00' AND event_ts <  TIMESTAMP '2024-09-17 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000661",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-14 00:00:00' AND event_ts <  TIMESTAMP '2024-09-21 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000662",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-18 00:00:00' AND event_ts <  TIMESTAMP '2024-09-25 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000663",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-08-27 00:00:00' AND event_ts <  TIMESTAMP '2024-09-26 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000664",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-01 00:00:00' AND event_ts <  TIMESTAMP '2024-09-27 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000665",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-01 00:00:00' AND event_ts <  TIMESTAMP '2024-10-01 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000666",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-27 00:00:00' AND event_ts <  TIMESTAMP '2024-10-04 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000667",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-05 00:00:00' AND event_ts <  TIMESTAMP '2024-10-05 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000668",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-01 00:00:00' AND event_ts <  TIMESTAMP '2024-10-09 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000669",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-10 00:00:00' AND event_ts <  TIMESTAMP '2024-10-10 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000670",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-04 00:00:00' AND event_ts <  TIMESTAMP '2024-10-11 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000671",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-11 00:00:00' AND event_ts <  TIMESTAMP '2024-10-18 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000672",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-12 00:00:00' AND event_ts <  TIMESTAMP '2024-10-19 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000673",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-20 00:00:00' AND event_ts <  TIMESTAMP '2024-10-20 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000674",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-22 00:00:00' AND event_ts <  TIMESTAMP '2024-10-22 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000675",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-16 00:00:00' AND event_ts <  TIMESTAMP '2024-10-23 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000676",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-17 00:00:00' AND event_ts <  TIMESTAMP '2024-10-24 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000677",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-30 00:00:00' AND event_ts <  TIMESTAMP '2024-10-30 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000678",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-24 00:00:00' AND event_ts <  TIMESTAMP '2024-10-31 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000679",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-25 00:00:00' AND event_ts <  TIMESTAMP '2024-11-01 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000680",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-03 00:00:00' AND event_ts <  TIMESTAMP '2024-11-02 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000681",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-04 00:00:00' AND event_ts <  TIMESTAMP '2024-11-03 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000682",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-29 00:00:00' AND event_ts <  TIMESTAMP '2024-11-05 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000683",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-07 00:00:00' AND event_ts <  TIMESTAMP '2024-11-06 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000684",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-01 00:00:00' AND event_ts <  TIMESTAMP '2024-11-08 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000685",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-10 00:00:00' AND event_ts <  TIMESTAMP '2024-11-09 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000686",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-01 00:00:00' AND event_ts <  TIMESTAMP '2024-11-15 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000687",
    "tables": [
      "raw_digital_events",
      "tmp_e000687"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e000687 AS         WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,        ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000687 AS\n        WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-09 00:00:00' AND event_ts <  TIMESTAMP '2024-11-16 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;\n        SELECT * FROM tmp_e000687 LIMIT 500;"
  },
  {
    "sql_id": "S000688",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-21 00:00:00' AND event_ts <  TIMESTAMP '2024-11-20 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000689",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-14 00:00:00' AND event_ts <  TIMESTAMP '2024-11-21 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000690",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-01 00:00:00' AND event_ts <  TIMESTAMP '2024-11-23 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000691",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-01 00:00:00' AND event_ts <  TIMESTAMP '2024-11-25 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000692",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-29 00:00:00' AND event_ts <  TIMESTAMP '2024-11-28 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000693",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-03 00:00:00' AND event_ts <  TIMESTAMP '2024-12-03 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000694",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-29 00:00:00' AND event_ts <  TIMESTAMP '2024-12-06 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000695",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-30 00:00:00' AND event_ts <  TIMESTAMP '2024-12-07 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000696",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-12 00:00:00' AND event_ts <  TIMESTAMP '2024-12-12 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000697",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-12-07 00:00:00' AND event_ts <  TIMESTAMP '2024-12-14 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000698",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-12-01 00:00:00' AND event_ts <  TIMESTAMP '2024-12-19 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000699",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-20 00:00:00' AND event_ts <  TIMESTAMP '2024-12-20 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000700",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-24 00:00:00' AND event_ts <  TIMESTAMP '2024-12-24 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000701",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-01-01 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-01-02 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000702",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-01-09 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-01-16 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    -- sanity-check filters\nORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000703",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-01-23 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-01-30 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000704",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) A...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-01-01 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-02-06 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000705",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-02-06 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-02-13 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000706",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-02-13 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-02-20 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000707",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-02-20 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-02-27 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000708",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-01-01 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-03-05 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000709",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-02-27 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-03-12 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000710",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-01-01 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-03-19 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    -- sanity-check filters\nORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000711",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-04-16 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-04-23 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000712",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-04-01 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-04-30 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000713",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-04-30 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-05-14 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000714",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) A...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-04-01 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-05-21 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000715",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-05-21 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-05-28 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000716",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-05-28 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-06-04 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000717",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-06-04 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-06-18 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000718",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-06-11 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-06-25 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000719",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-06-25 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-07-02 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000720",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-07-09 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-07-16 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000721",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-07-09 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-07-23 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000722",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-07-01 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-07-30 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000723",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-07-30 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-08-06 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000724",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-07-30 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-08-13 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000725",
    "tables": [
      "raw_ticket_sales",
      "tmp_e000725"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "CREATE TEMP TABLE tmp_e000725 AS         SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000725 AS\n        SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-08-06 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-08-20 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;\n        SELECT * FROM tmp_e000725 LIMIT 500;"
  },
  {
    "sql_id": "S000726",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-08-27 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-09-03 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000727",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-09-17 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-09-24 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000728",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-10-08 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-10-22 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000729",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-10-22 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-10-29 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000730",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-11-05 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-11-12 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000731",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-10-01 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-11-19 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000732",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-10-01 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-11-26 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000733",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-11-26 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-12-10 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000734",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) A...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-12-03 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-12-17 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000735",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-12-17 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-12-24 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    -- sanity-check filters\nORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000736",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-01-01 00:00:00'...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-01-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-01-02 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-01-01 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-01-02 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000737",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-01-01 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-01-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-01-09 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-01-01 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-01-09 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000738",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-01-09 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-01-09 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-01-23 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-01-09 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-01-23 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000739",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-01-23 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-01-23 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-01-30 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-01-23 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-01-30 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000740",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-01-30 00:00:00'...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-01-30 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-02-06 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-01-30 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-02-06 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000741",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-01-30 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-01-30 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-02-13 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-01-30 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-02-13 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000742",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-02-20 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-02-20 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-02-27 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-02-20 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-02-27 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000743",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders",
      "tmp_e000743"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e000743 AS         -- dashboard_extract: exec summary WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purcha...",
    "sql_full": "CREATE TEMP TABLE tmp_e000743 AS\n        -- dashboard_extract: exec summary\nWITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-02-27 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-03-05 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-02-27 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-03-05 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;\n        SELECT * FROM tmp_e000743 LIMIT 500;"
  },
  {
    "sql_id": "S000744",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-01-01 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-01-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-03-12 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-01-01 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-03-12 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000745",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-03-05 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-03-05 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-03-19 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-03-05 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-03-19 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000746",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders",
      "tmp_e000746"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e000746 AS         WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-03-19 00:...",
    "sql_full": "CREATE TEMP TABLE tmp_e000746 AS\n        WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-03-19 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-03-26 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-03-19 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-03-26 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;\n        SELECT * FROM tmp_e000746 LIMIT 500;"
  },
  {
    "sql_id": "S000747",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-04-16 00:00:00'...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-04-16 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-04-23 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-04-16 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-04-23 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000748",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-04-30 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-04-30 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-05-07 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-04-30 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-05-07 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000749",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-04-01 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-04-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-05-14 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-04-01 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-05-14 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000750",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-05-21 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-05-21 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-05-28 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-05-21 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-05-28 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000751",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-05-28 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-05-28 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-06-04 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-05-28 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-06-04 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000752",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders",
      "tmp_e000752"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e000752 AS         WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-06-25 00:...",
    "sql_full": "CREATE TEMP TABLE tmp_e000752 AS\n        WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-06-25 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-07-02 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-06-25 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-07-02 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;\n        SELECT * FROM tmp_e000752 LIMIT 500;"
  },
  {
    "sql_id": "S000753",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-07-09 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-07-09 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-07-16 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-07-09 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-07-16 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000754",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-08-06 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-08-06 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-08-13 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-08-06 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-08-13 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000755",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-08-06 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-08-06 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-08-20 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-08-06 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-08-20 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000756",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-08-13 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-08-13 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-08-27 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-08-13 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-08-27 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000757",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-07-01 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-07-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-10 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-07-01 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-09-10 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000758",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-09-03 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-09-03 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-17 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-09-03 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-09-17 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000759",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-09-24 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-09-24 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-10-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-09-24 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-10-01 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000760",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-10-01 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-10-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-10-08 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-10-01 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-10-08 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000761",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-10-08 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-10-08 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-10-15 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-10-08 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-10-15 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000762",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-10-01 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-10-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-10-22 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-10-01 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-10-22 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000763",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-10-01 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-10-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-10-29 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-10-01 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-10-29 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000764",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-10-29 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-10-29 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-11-05 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-10-29 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-11-05 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000765",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders",
      "tmp_e000765"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e000765 AS         WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-11-05 00:...",
    "sql_full": "CREATE TEMP TABLE tmp_e000765 AS\n        WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-11-05 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-11-12 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-11-05 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-11-12 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;\n        SELECT * FROM tmp_e000765 LIMIT 500;"
  },
  {
    "sql_id": "S000766",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders",
      "tmp_e000766"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e000766 AS         -- dashboard_extract: exec summary WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purcha...",
    "sql_full": "CREATE TEMP TABLE tmp_e000766 AS\n        -- dashboard_extract: exec summary\nWITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-11-12 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-11-19 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-11-12 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-11-19 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;\n        SELECT * FROM tmp_e000766 LIMIT 500;"
  },
  {
    "sql_id": "S000767",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-11-19 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-11-19 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-11-26 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-11-19 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-11-26 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000768",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-11-26 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-11-26 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-12-03 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-11-26 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-12-03 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000769",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-12-03 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-12-03 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-12-17 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-12-03 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-12-17 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000770",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-12-24 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-12-24 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-12-31 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-12-24 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-12-31 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000771",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-01-01 00:00:00' AND created_ts <  TIMESTAMP '2024-01-09 00:00:00' AND resolved_ts IS NOT NULL AND category = 'SEATING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000772",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-01-16 00:00:00' AND created_ts <  TIMESTAMP '2024-01-23 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000773",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600....",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-01-16 00:00:00' AND created_ts <  TIMESTAMP '2024-01-30 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000774",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-01-30 00:00:00' AND created_ts <  TIMESTAMP '2024-02-06 00:00:00' AND resolved_ts IS NOT NULL AND category = 'ACCESS'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (-- sanity-check filters\nORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000775",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-01-30 00:00:00' AND created_ts <  TIMESTAMP '2024-02-13 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000776",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-02-13 00:00:00' AND created_ts <  TIMESTAMP '2024-02-20 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000777",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-02-13 00:00:00' AND created_ts <  TIMESTAMP '2024-02-27 00:00:00' AND resolved_ts IS NOT NULL AND category = 'SEATING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000778",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-01-01 00:00:00' AND created_ts <  TIMESTAMP '2024-03-05 00:00:00' AND resolved_ts IS NOT NULL AND category = 'BILLING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (-- sanity-check filters\nORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000779",
    "tables": [
      "support_tickets",
      "tmp_e000779"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "CREATE TEMP TABLE tmp_e000779 AS         WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) /...",
    "sql_full": "CREATE TEMP TABLE tmp_e000779 AS\n        WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-02-27 00:00:00' AND created_ts <  TIMESTAMP '2024-03-12 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;\n        SELECT * FROM tmp_e000779 LIMIT 500;"
  },
  {
    "sql_id": "S000780",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-03-26 00:00:00' AND created_ts <  TIMESTAMP '2024-04-02 00:00:00' AND resolved_ts IS NOT NULL AND category = 'BILLING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000781",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600....",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-03-26 00:00:00' AND created_ts <  TIMESTAMP '2024-04-09 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000782",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-04-09 00:00:00' AND created_ts <  TIMESTAMP '2024-04-23 00:00:00' AND resolved_ts IS NOT NULL AND category = 'BILLING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000783",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-04-23 00:00:00' AND created_ts <  TIMESTAMP '2024-04-30 00:00:00' AND resolved_ts IS NOT NULL AND category = 'BILLING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000784",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-04-30 00:00:00' AND created_ts <  TIMESTAMP '2024-05-07 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000785",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-05-14 00:00:00' AND created_ts <  TIMESTAMP '2024-05-21 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000786",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-05-21 00:00:00' AND created_ts <  TIMESTAMP '2024-05-28 00:00:00' AND resolved_ts IS NOT NULL AND category = 'SEATING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000787",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-07-09 00:00:00' AND created_ts <  TIMESTAMP '2024-07-16 00:00:00' AND resolved_ts IS NOT NULL AND category = 'MERCH'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000788",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-07-09 00:00:00' AND created_ts <  TIMESTAMP '2024-07-23 00:00:00' AND resolved_ts IS NOT NULL AND category = 'ACCESS'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000789",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-07-30 00:00:00' AND created_ts <  TIMESTAMP '2024-08-06 00:00:00' AND resolved_ts IS NOT NULL AND category = 'BILLING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (-- sanity-check filters\nORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000790",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-08-06 00:00:00' AND created_ts <  TIMESTAMP '2024-08-13 00:00:00' AND resolved_ts IS NOT NULL AND category = 'ACCESS'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000791",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-07-01 00:00:00' AND created_ts <  TIMESTAMP '2024-08-20 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000792",
    "tables": [
      "support_tickets",
      "tmp_e000792"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "CREATE TEMP TABLE tmp_e000792 AS         WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) /...",
    "sql_full": "CREATE TEMP TABLE tmp_e000792 AS\n        WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-08-20 00:00:00' AND created_ts <  TIMESTAMP '2024-08-27 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;\n        SELECT * FROM tmp_e000792 LIMIT 500;"
  },
  {
    "sql_id": "S000793",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-09-10 00:00:00' AND created_ts <  TIMESTAMP '2024-09-24 00:00:00' AND resolved_ts IS NOT NULL AND category = 'ACCESS'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000794",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600....",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-09-24 00:00:00' AND created_ts <  TIMESTAMP '2024-10-01 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000795",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-10-01 00:00:00' AND created_ts <  TIMESTAMP '2024-10-08 00:00:00' AND resolved_ts IS NOT NULL AND category = 'BILLING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (-- sanity-check filters\nORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000796",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-10-08 00:00:00' AND created_ts <  TIMESTAMP '2024-10-15 00:00:00' AND resolved_ts IS NOT NULL AND category = 'BILLING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000797",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-10-15 00:00:00' AND created_ts <  TIMESTAMP '2024-10-22 00:00:00' AND resolved_ts IS NOT NULL AND category = 'BILLING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000798",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-10-15 00:00:00' AND created_ts <  TIMESTAMP '2024-10-29 00:00:00' AND resolved_ts IS NOT NULL AND category = 'ACCESS'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000799",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-10-29 00:00:00' AND created_ts <  TIMESTAMP '2024-11-05 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000800",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-11-12 00:00:00' AND created_ts <  TIMESTAMP '2024-11-19 00:00:00' AND resolved_ts IS NOT NULL AND category = 'SEATING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (-- sanity-check filters\nORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000801",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-10-01 00:00:00' AND created_ts <  TIMESTAMP '2024-11-26 00:00:00' AND resolved_ts IS NOT NULL AND category = 'BILLING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000802",
    "tables": [
      "support_tickets",
      "tmp_e000802"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "CREATE TEMP TABLE tmp_e000802 AS         WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) /...",
    "sql_full": "CREATE TEMP TABLE tmp_e000802 AS\n        WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-11-26 00:00:00' AND created_ts <  TIMESTAMP '2024-12-03 00:00:00' AND resolved_ts IS NOT NULL AND category = 'BILLING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;\n        SELECT * FROM tmp_e000802 LIMIT 500;"
  },
  {
    "sql_id": "S000803",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-12-10 00:00:00' AND created_ts <  TIMESTAMP '2024-12-17 00:00:00' AND resolved_ts IS NOT NULL AND category = 'ACCESS'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000804",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-12-17 00:00:00' AND created_ts <  TIMESTAMP '2024-12-24 00:00:00' AND resolved_ts IS NOT NULL AND category = 'MERCH'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000805",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600....",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-12-24 00:00:00' AND created_ts <  TIMESTAMP '2024-12-31 00:00:00' AND resolved_ts IS NOT NULL AND category = 'SEATING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000806",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-01-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-01-02 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000807",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-01-02 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-01-16 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000808",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches",
      "tmp_e000808"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "CREATE TEMP TABLE tmp_e000808 AS         WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenu...",
    "sql_full": "CREATE TEMP TABLE tmp_e000808 AS\n        WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-01-16 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-01-23 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;\n        SELECT * FROM tmp_e000808 LIMIT 500;"
  },
  {
    "sql_id": "S000809",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-01-23 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-01-30 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000810",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-01-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-02-13 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000811",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-02-13 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-02-20 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000812",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-03-05 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-03-12 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000813",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-03-12 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-03-19 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000814",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-03-19 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-03-26 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000815",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-03-26 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-04-09 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000816",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-04-16 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-04-30 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000817",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-04-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-05-14 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000818",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-05-07 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-05-21 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000819",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-05-28 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-06-04 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000820",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-06-11 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-06-18 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000821",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches",
      "tmp_e000821"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "CREATE TEMP TABLE tmp_e000821 AS         WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenu...",
    "sql_full": "CREATE TEMP TABLE tmp_e000821 AS\n        WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-04-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-06-25 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY attributed_net_revenue DESC;\n        SELECT * FROM tmp_e000821 LIMIT 500;"
  },
  {
    "sql_id": "S000822",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "-- dashboard_extract: exec summary WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-06-25 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-07-02 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000823",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-07-02 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-07-16 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000824",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-07-16 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-07-23 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000825",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-07-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-07-30 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000826",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-08-13 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-08-20 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000827",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-08-13 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-08-27 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000828",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-08-27 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-03 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000829",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-08-27 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-10 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000830",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches",
      "tmp_e000830"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "CREATE TEMP TABLE tmp_e000830 AS         WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenu...",
    "sql_full": "CREATE TEMP TABLE tmp_e000830 AS\n        WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-09-10 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-17 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;\n        SELECT * FROM tmp_e000830 LIMIT 500;"
  },
  {
    "sql_id": "S000831",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches",
      "tmp_e000831"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "CREATE TEMP TABLE tmp_e000831 AS         WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenu...",
    "sql_full": "CREATE TEMP TABLE tmp_e000831 AS\n        WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-09-17 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-24 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;\n        SELECT * FROM tmp_e000831 LIMIT 500;"
  },
  {
    "sql_id": "S000832",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-09-24 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-10-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000833",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "-- dashboard_extract: exec summary WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-10-08 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-10-15 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000834",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-10-15 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-10-22 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000835",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches",
      "tmp_e000835"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "CREATE TEMP TABLE tmp_e000835 AS         WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenu...",
    "sql_full": "CREATE TEMP TABLE tmp_e000835 AS\n        WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-10-22 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-10-29 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;\n        SELECT * FROM tmp_e000835 LIMIT 500;"
  },
  {
    "sql_id": "S000836",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-10-29 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-11-05 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000837",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-11-19 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-11-26 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000838",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-11-26 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-12-03 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000839",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches",
      "tmp_e000839"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "CREATE TEMP TABLE tmp_e000839 AS         WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenu...",
    "sql_full": "CREATE TEMP TABLE tmp_e000839 AS\n        WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-10-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-12-10 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;\n        SELECT * FROM tmp_e000839 LIMIT 500;"
  },
  {
    "sql_id": "S000840",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches",
      "tmp_e000840"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "CREATE TEMP TABLE tmp_e000840 AS         WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenu...",
    "sql_full": "CREATE TEMP TABLE tmp_e000840 AS\n        WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-12-17 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-12-24 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;\n        SELECT * FROM tmp_e000840 LIMIT 500;"
  },
  {
    "sql_id": "S000841",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-02-01 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-02-01 00:00:00' - INTERVAL '365 days')\n        AND purchased_at <  TIMESTAMP '2024-02-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-02-01 00:00:00' - INTERVAL '365 days')\n        AND order_ts <  TIMESTAMP '2024-02-01 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-02-01 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-02-01 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY customers DESC;"
  },
  {
    "sql_id": "S000842",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "-- dashboard_extract: exec summary WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchase...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-03-01 00:00:00' - INTERVAL '365 days')\n        AND purchased_at <  TIMESTAMP '2024-03-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-03-01 00:00:00' - INTERVAL '365 days')\n        AND order_ts <  TIMESTAMP '2024-03-01 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-03-01 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-03-01 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S000843",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "-- dashboard_extract: exec summary WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchase...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-04-01 00:00:00' - INTERVAL '365 days')\n        AND purchased_at <  TIMESTAMP '2024-04-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-04-01 00:00:00' - INTERVAL '365 days')\n        AND order_ts <  TIMESTAMP '2024-04-01 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-04-01 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-04-01 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY customers DESC;"
  },
  {
    "sql_id": "S000844",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-05-01 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-05-01 00:00:00' - INTERVAL '365 days')\n        AND purchased_at <  TIMESTAMP '2024-05-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-05-01 00:00:00' - INTERVAL '365 days')\n        AND order_ts <  TIMESTAMP '2024-05-01 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-05-01 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-05-01 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S000845",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-07-01 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-07-01 00:00:00' - INTERVAL '365 days')\n        AND purchased_at <  TIMESTAMP '2024-07-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-07-01 00:00:00' - INTERVAL '365 days')\n        AND order_ts <  TIMESTAMP '2024-07-01 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-07-01 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-07-01 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S000846",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "-- dashboard_extract: exec summary WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchase...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-08-01 00:00:00' - INTERVAL '365 days')\n        AND purchased_at <  TIMESTAMP '2024-08-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-08-01 00:00:00' - INTERVAL '365 days')\n        AND order_ts <  TIMESTAMP '2024-08-01 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-08-01 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-08-01 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S000847",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "-- dashboard_extract: exec summary WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchase...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-09-01 00:00:00' - INTERVAL '365 days')\n        AND purchased_at <  TIMESTAMP '2024-09-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-09-01 00:00:00' - INTERVAL '365 days')\n        AND order_ts <  TIMESTAMP '2024-09-01 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-09-01 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-09-01 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S000848",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-10-01 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-10-01 00:00:00' - INTERVAL '365 days')\n        AND purchased_at <  TIMESTAMP '2024-10-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-10-01 00:00:00' - INTERVAL '365 days')\n        AND order_ts <  TIMESTAMP '2024-10-01 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-10-01 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-10-01 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S000849",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "-- dashboard_extract: exec summary WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchase...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-11-01 00:00:00' - INTERVAL '365 days')\n        AND purchased_at <  TIMESTAMP '2024-11-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-11-01 00:00:00' - INTERVAL '365 days')\n        AND order_ts <  TIMESTAMP '2024-11-01 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-11-01 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-11-01 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S000850",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2025-01-01 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2025-01-01 00:00:00' - INTERVAL '365 days')\n        AND purchased_at <  TIMESTAMP '2025-01-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2025-01-01 00:00:00' - INTERVAL '365 days')\n        AND order_ts <  TIMESTAMP '2025-01-01 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2025-01-01 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2025-01-01 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S000851",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHER...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-01-01 00:00:00' AND created_ts <  TIMESTAMP '2024-02-01 00:00:00' AND stage = 'WON'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S000852",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-02-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-02-01 00:00:00' AND created_ts <  TIMESTAMP '2024-03-01 00:00:00' AND stage = 'LEAD'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S000853",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-04-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-04-01 00:00:00' AND created_ts <  TIMESTAMP '2024-05-01 00:00:00' AND stage = 'PROPOSAL'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S000854",
    "tables": [
      "crm_deals",
      "tmp_e000854"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "CREATE TEMP TABLE tmp_e000854 AS         SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals   ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000854 AS\n        SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-05-01 00:00:00' AND created_ts <  TIMESTAMP '2024-06-01 00:00:00' AND stage = 'LOST'\n    GROUP BY 1,2\n    ORDER BY month, stage;\n        SELECT * FROM tmp_e000854 LIMIT 500;"
  },
  {
    "sql_id": "S000855",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-06-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-06-01 00:00:00' AND created_ts <  TIMESTAMP '2024-07-01 00:00:00' AND stage = 'LEAD'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S000856",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-07-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-07-01 00:00:00' AND created_ts <  TIMESTAMP '2024-08-01 00:00:00' AND stage = 'PROPOSAL'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S000857",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-08-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-08-01 00:00:00' AND created_ts <  TIMESTAMP '2024-09-01 00:00:00' AND stage = 'LOST'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S000858",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-09-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-09-01 00:00:00' AND created_ts <  TIMESTAMP '2024-10-01 00:00:00' AND stage = 'QUALIFIED'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S000859",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHER...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-10-01 00:00:00' AND created_ts <  TIMESTAMP '2024-11-01 00:00:00' AND stage = 'LEAD'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S000860",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-12-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-12-01 00:00:00' AND created_ts <  TIMESTAMP '2025-01-01 00:00:00' AND stage = 'LOST'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S000861",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-01-01 00:00:00' AND created_ts <  TIMESTAMP '2024-02-01 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000862",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-03-01 00:00:00' AND created_ts <  TIMESTAMP '2024-04-01 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000863",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-04-01 00:00:00' AND created_ts <  TIMESTAMP '2024-05-01 00:00:00' AND resolved_ts IS NOT NULL AND category = 'MERCH'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000864",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-05-01 00:00:00' AND created_ts <  TIMESTAMP '2024-06-01 00:00:00' AND resolved_ts IS NOT NULL AND category = 'MERCH'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (-- sanity-check filters\nORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000865",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-06-01 00:00:00' AND created_ts <  TIMESTAMP '2024-07-01 00:00:00' AND resolved_ts IS NOT NULL AND category = 'MERCH'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000866",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600....",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-08-01 00:00:00' AND created_ts <  TIMESTAMP '2024-09-01 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000867",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-09-01 00:00:00' AND created_ts <  TIMESTAMP '2024-10-01 00:00:00' AND resolved_ts IS NOT NULL AND category = 'MERCH'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000868",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-10-01 00:00:00' AND created_ts <  TIMESTAMP '2024-11-01 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000869",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-11-01 00:00:00' AND created_ts <  TIMESTAMP '2024-12-01 00:00:00' AND resolved_ts IS NOT NULL AND category = 'MERCH'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000870",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-12-01 00:00:00' AND created_ts <  TIMESTAMP '2025-01-01 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (-- sanity-check filters\nORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000871",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-01-01 00:00:00'...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-01-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-02-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-01-01 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-02-01 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000872",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-02-01 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-02-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-03-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-02-01 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-03-01 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000873",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-03-01 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-03-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-04-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-03-01 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-04-01 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000874",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-04-01 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-04-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-05-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-04-01 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-05-01 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000875",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-07-01 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-07-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-08-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-07-01 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-08-01 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000876",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-08-01 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-08-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-08-01 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-09-01 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000877",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-09-01 00:00:00'...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-09-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-10-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-09-01 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-10-01 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000878",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-10-01 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-10-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-11-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-10-01 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-11-01 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000879",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-11-01 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-11-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-12-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-11-01 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-12-01 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000880",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-12-01 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-12-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2025-01-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-12-01 00:00:00'\n        AND order_ts <  (TIMESTAMP '2025-01-01 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000881",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-09-03 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-09-17 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000882",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-09-09 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-09-17 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000883",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-07-01 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-09-17 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000884",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-09-13 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-09-17 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000885",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-09 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000886",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000887",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-12 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000888",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-12 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000889",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000890",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-30 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000891",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-04 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000892",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-30 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000893",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-06-03 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-06-07 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000894",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-04-01 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-06-07 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    -- sanity-check filters\nORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000895",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-05-24 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-06-07 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000896",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-02-24 00:00:00' AND event_ts <  TIMESTAMP '2024-02-27 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000897",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-02-24 00:00:00' AND event_ts <  TIMESTAMP '2024-02-27 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000898",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-02-12 00:00:00' AND event_ts <  TIMESTAMP '2024-02-27 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000899",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-01-23 00:00:00' AND event_ts <  TIMESTAMP '2024-02-27 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000900",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e000900"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000900 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e000900 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-05 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000900 LIMIT 500;"
  },
  {
    "sql_id": "S000901",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-13 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000902",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-08-28 00:00:00' AND event_ts <  TIMESTAMP '2024-08-31 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000903",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-08-20 00:00:00' AND event_ts <  TIMESTAMP '2024-08-31 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000904",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-08-24 00:00:00' AND event_ts <  TIMESTAMP '2024-08-31 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000905",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-08-24 00:00:00' AND event_ts <  TIMESTAMP '2024-08-31 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000906",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-27 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000907",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000908",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000909",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-09 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000910",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-09-17 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-09-24 00:00:00'\n    GROUP BY 1  -- variant,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000911",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) A...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-09-18 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-09-24 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000912",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-09-18 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-09-24 00:00:00'\n    GROUP BY 1  -- variant,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000913",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-09-21 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-09-24 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000914",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e000914"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000914 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e000914 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-29 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000914 LIMIT 500;"
  },
  {
    "sql_id": "S000915",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000916",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-08-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000917",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-08-22 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000918",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-07-02 00:00:00' AND event_ts <  TIMESTAMP '2024-07-09 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000919",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-06-24 00:00:00' AND event_ts <  TIMESTAMP '2024-07-09 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000920",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000921",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-06 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000922",
    "tables": [
      "raw_ticket_sales",
      "tmp_e000922"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "CREATE TEMP TABLE tmp_e000922 AS         SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000922 AS\n        SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-02-04 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-02-10 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    -- sanity-check filters\nORDER BY refund_rate DESC, tickets DESC;\n        SELECT * FROM tmp_e000922 LIMIT 500;"
  },
  {
    "sql_id": "S000923",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-02-08 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-02-10 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000924",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-01-27 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-02-10 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000925",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-01-27 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-02-10 00:00:00'\n    GROUP BY 1  -- variant,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000926",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-01-01 00:00:00' AND event_ts <  TIMESTAMP '2024-01-12 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000927",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-01-06 00:00:00' AND event_ts <  TIMESTAMP '2024-01-12 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000928",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-02 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000929",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-06-29 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000930",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-03 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000931",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-20 00:00:00' AND event_ts <  TIMESTAMP '2024-09-27 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000932",
    "tables": [
      "raw_digital_events",
      "tmp_e000932"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e000932 AS         WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,        ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000932 AS\n        WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-21 00:00:00' AND event_ts <  TIMESTAMP '2024-09-27 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;\n        SELECT * FROM tmp_e000932 LIMIT 500;"
  },
  {
    "sql_id": "S000933",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-12 00:00:00' AND event_ts <  TIMESTAMP '2024-09-27 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000934",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-06-10 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-06-18 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000935",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-06-14 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-06-18 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000936",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-04-12 00:00:00' AND event_ts <  TIMESTAMP '2024-05-10 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000937",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-04-01 00:00:00' AND event_ts <  TIMESTAMP '2024-05-10 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000938",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-05-03 00:00:00' AND event_ts <  TIMESTAMP '2024-05-10 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000939",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-04-01 00:00:00' AND event_ts <  TIMESTAMP '2024-05-10 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000940",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-11-26 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-11-29 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000941",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-11-01 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-11-29 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000942",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-11-21 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-11-29 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000943",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) A...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-11-14 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-11-29 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000944",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-10-23 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-10-29 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    -- sanity-check filters\nORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000945",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-10-01 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-10-29 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000946",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) A...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-10-08 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-10-29 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000947",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000948",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000949",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-29 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000950",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-09 00:00:00' AND event_ts <  TIMESTAMP '2024-11-13 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000951",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-07 00:00:00' AND event_ts <  TIMESTAMP '2024-11-13 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000952",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-11 00:00:00' AND event_ts <  TIMESTAMP '2024-11-13 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000953",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-07-20 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-07-23 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000954",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-07-20 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-07-23 00:00:00'\n    GROUP BY 1  -- variant,2\n    HAVING COUNT(*) >= 50\n    -- sanity-check filters\nORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000955",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-07-20 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-07-23 00:00:00'\n    GROUP BY 1  -- variant,2\n    HAVING COUNT(*) >= 50\n    -- sanity-check filters\nORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000956",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-07-08 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-07-23 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S000957",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000958",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000958"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000958 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e000958 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;\n        SELECT * FROM tmp_e000958 LIMIT 500;"
  },
  {
    "sql_id": "S000959",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000960",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-18 00:00:00' AND event_ts <  TIMESTAMP '2024-11-08 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000961",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-04 00:00:00' AND event_ts <  TIMESTAMP '2024-11-08 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000962",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000963",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000964",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-30 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000965",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-02 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000966",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-09 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000967",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-03-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000968",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000969",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e000969"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e000969 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e000969 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-19 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e000969 LIMIT 500;"
  },
  {
    "sql_id": "S000970",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-28 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000971",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000972",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-12-01 00:00:00' AND event_ts <  TIMESTAMP '2024-12-05 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000973",
    "tables": [
      "raw_digital_events",
      "tmp_e000973"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e000973 AS         WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,        ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000973 AS\n        WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-28 00:00:00' AND event_ts <  TIMESTAMP '2024-12-05 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;\n        SELECT * FROM tmp_e000973 LIMIT 500;"
  },
  {
    "sql_id": "S000974",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-01-01 00:00:00' AND event_ts <  TIMESTAMP '2024-01-09 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000975",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-28 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000976",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000977",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-11-20 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-11-20 00:00:00' - INTERVAL '90 days')\n        AND purchased_at <  TIMESTAMP '2024-11-20 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-11-20 00:00:00' - INTERVAL '90 days')\n        AND order_ts <  TIMESTAMP '2024-11-20 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-11-20 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-11-20 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S000978",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-30 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000979",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000980",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-15 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-29 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000981",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-04 00:00:00' AND event_ts <  TIMESTAMP '2024-11-19 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000982",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-09-24 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-09-24 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-11-26 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-09-24 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-11-26 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000983",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-03-16 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-03-19 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S000984",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-08 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000985",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-10-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000986",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-08-17 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000987",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-22 00:00:00' AND event_ts <  TIMESTAMP '2024-10-20 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S000988",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-10-08 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-14 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S000989",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans",
      "tmp_e000989"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e000989 AS         WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week ...",
    "sql_full": "CREATE TEMP TABLE tmp_e000989 AS\n        WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-05-19 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;\n        SELECT * FROM tmp_e000989 LIMIT 500;"
  },
  {
    "sql_id": "S000990",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-19 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S000991",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-09-04 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-09-04 00:00:00' - INTERVAL '365 days')\n        AND purchased_at <  TIMESTAMP '2024-09-04 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-09-04 00:00:00' - INTERVAL '365 days')\n        AND order_ts <  TIMESTAMP '2024-09-04 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-09-04 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-09-04 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S000992",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-05-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-05-29 00:00:00' AND created_ts <  TIMESTAMP '2024-06-04 00:00:00' AND stage = 'LEAD'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S000993",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-09-03 00:00:00' AND created_ts <  TIMESTAMP '2024-09-06 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (-- sanity-check filters\nORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000994",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-03-13 00:00:00' AND created_ts <  TIMESTAMP '2024-03-19 00:00:00' AND resolved_ts IS NOT NULL AND category = 'BILLING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000995",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-07-19 00:00:00' AND created_ts <  TIMESTAMP '2024-07-27 00:00:00' AND resolved_ts IS NOT NULL AND category = 'ACCESS'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S000996",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "-- dashboard_extract: exec summary WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchase...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-07-16 00:00:00' - INTERVAL '90 days')\n        AND purchased_at <  TIMESTAMP '2024-07-16 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-07-16 00:00:00' - INTERVAL '90 days')\n        AND order_ts <  TIMESTAMP '2024-07-16 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-07-16 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-07-16 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S000997",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-10-25 00:00:00'...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-10-25 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-11-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-10-25 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-11-01 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S000998",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-10-16 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-10-16 00:00:00' - INTERVAL '180 days')\n        AND purchased_at <  TIMESTAMP '2024-10-16 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-10-16 00:00:00' - INTERVAL '180 days')\n        AND order_ts <  TIMESTAMP '2024-10-16 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-10-16 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-10-16 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S000999",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-11-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-11-13 00:00:00' AND created_ts <  TIMESTAMP '2024-11-19 00:00:00' AND stage = 'QUALIFIED'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001000",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-12-18 00:00:00' AND event_ts <  TIMESTAMP '2024-12-21 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001001",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans",
      "tmp_e001001"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e001001 AS         -- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.ev...",
    "sql_full": "CREATE TEMP TABLE tmp_e001001 AS\n        -- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-12-06 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;\n        SELECT * FROM tmp_e001001 LIMIT 500;"
  },
  {
    "sql_id": "S001002",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- ad-hoc rerun WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sal...",
    "sql_full": "-- ad-hoc rerun\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-12-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-14 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001003",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-03-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-03-11 00:00:00' AND created_ts <  TIMESTAMP '2024-06-16 00:00:00' AND stage = 'LEAD'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001004",
    "tables": [
      "raw_digital_events",
      "tmp_e001004"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e001004 AS         WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,        ...",
    "sql_full": "CREATE TEMP TABLE tmp_e001004 AS\n        WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-05-06 00:00:00' AND event_ts <  TIMESTAMP '2024-05-10 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;\n        SELECT * FROM tmp_e001004 LIMIT 500;"
  },
  {
    "sql_id": "S001005",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-06-13 00:00:00' AND created_ts <  TIMESTAMP '2024-06-20 00:00:00' AND resolved_ts IS NOT NULL AND category = 'ACCESS'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001006",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-02 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001007",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-09-22 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-09-22 00:00:00' - INTERVAL '365 days')\n        AND purchased_at <  TIMESTAMP '2024-09-22 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-09-22 00:00:00' - INTERVAL '365 days')\n        AND order_ts <  TIMESTAMP '2024-09-22 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-09-22 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-09-22 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001008",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-11-08 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-11-19 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001009",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-06 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001010",
    "tables": [
      "support_tickets",
      "tmp_e001010"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "CREATE TEMP TABLE tmp_e001010 AS         WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) /...",
    "sql_full": "CREATE TEMP TABLE tmp_e001010 AS\n        WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-09-27 00:00:00' AND created_ts <  TIMESTAMP '2024-09-30 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (-- sanity-check filters\nORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY resolved_tickets DESC;\n        SELECT * FROM tmp_e001010 LIMIT 500;"
  },
  {
    "sql_id": "S001011",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-12-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-12-13 00:00:00' AND created_ts <  TIMESTAMP '2024-12-27 00:00:00' AND stage = 'WON'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001012",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001013",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) A...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-01-01 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-03-12 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    -- sanity-check filters\nORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001014",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-04-20 00:00:00' AND created_ts <  TIMESTAMP '2024-04-23 00:00:00' AND resolved_ts IS NOT NULL AND category = 'MERCH'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (-- sanity-check filters\nORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001015",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-09-08 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-09-08 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-15 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-09-08 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-09-15 00:00:00' + INTERVAL '3 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '3 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001016",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-07-15 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-07-19 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001017",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-01-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-01-16 00:00:00' AND created_ts <  TIMESTAMP '2024-01-23 00:00:00' AND stage = 'QUALIFIED'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001018",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-10-09 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-10-17 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001019",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-31 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001020",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-09 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001021",
    "tables": [
      "crm_deals",
      "tmp_e001021"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "CREATE TEMP TABLE tmp_e001021 AS         SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals   ...",
    "sql_full": "CREATE TEMP TABLE tmp_e001021 AS\n        SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-07-26 00:00:00' AND created_ts <  TIMESTAMP '2024-08-01 00:00:00' AND stage = 'LOST'\n    GROUP BY 1,2\n    ORDER BY month, stage;\n        SELECT * FROM tmp_e001021 LIMIT 500;"
  },
  {
    "sql_id": "S001022",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-27 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001023",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-06-17 00:00:00' AND event_ts <  TIMESTAMP '2024-07-17 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001024",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-02-19 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-03-05 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001025",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-04-02 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-04-16 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001026",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-01-01 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-01-04 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001027",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "-- dashboard_extract: exec summary WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-03-08 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-03-19 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001028",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-09 00:00:00' AND event_ts <  TIMESTAMP '2024-10-15 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001029",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-08-23 00:00:00' AND event_ts <  TIMESTAMP '2024-09-27 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001030",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001031",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-11-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-11-20 00:00:00' AND created_ts <  TIMESTAMP '2024-11-26 00:00:00' AND stage = 'LEAD'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001032",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-05-03 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-05-03 00:00:00' - INTERVAL '90 days')\n        AND purchased_at <  TIMESTAMP '2024-05-03 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-05-03 00:00:00' - INTERVAL '90 days')\n        AND order_ts <  TIMESTAMP '2024-05-03 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-05-03 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-05-03 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001033",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-08-15 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-08-15 00:00:00' - INTERVAL '180 days')\n        AND purchased_at <  TIMESTAMP '2024-08-15 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-08-15 00:00:00' - INTERVAL '180 days')\n        AND order_ts <  TIMESTAMP '2024-08-15 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-08-15 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-08-15 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001034",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-12-20 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-12-27 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001035",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans",
      "tmp_e001035"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e001035 AS         WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week ...",
    "sql_full": "CREATE TEMP TABLE tmp_e001035 AS\n        WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-12-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-26 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY b.event_week, b.seat_section;\n        SELECT * FROM tmp_e001035 LIMIT 500;"
  },
  {
    "sql_id": "S001036",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-05-21 00:00:00' AND created_ts <  TIMESTAMP '2024-05-28 00:00:00' AND resolved_ts IS NOT NULL AND category = 'MERCH'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001037",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-18 00:00:00' AND event_ts <  TIMESTAMP '2024-11-20 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001038",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-11-26 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-11-26 00:00:00' - INTERVAL '365 days')\n        AND purchased_at <  TIMESTAMP '2024-11-26 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-11-26 00:00:00' - INTERVAL '365 days')\n        AND order_ts <  TIMESTAMP '2024-11-26 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-11-26 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-11-26 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001039",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-16 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001040",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-08-19 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-08-19 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-08-27 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-08-19 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-08-27 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001041",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-07-22 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-07-25 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001042",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-02-28 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-02-28 00:00:00' - INTERVAL '365 days')\n        AND purchased_at <  TIMESTAMP '2024-02-28 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-02-28 00:00:00' - INTERVAL '365 days')\n        AND order_ts <  TIMESTAMP '2024-02-28 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-02-28 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-02-28 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001043",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-11-11 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-11-11 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-11-19 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-11-11 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-11-19 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001044",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-01-02 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-01-09 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001045",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-04-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-04-05 00:00:00' AND created_ts <  TIMESTAMP '2024-04-12 00:00:00' AND stage = 'PROPOSAL'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001046",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-12-22 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-12-22 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-12-24 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-12-22 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-12-24 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001047",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-08-21 00:00:00' AND created_ts <  TIMESTAMP '2024-09-11 00:00:00' AND resolved_ts IS NOT NULL AND category = 'BILLING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001048",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001049",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001050",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-10-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-10-31 00:00:00' AND created_ts <  TIMESTAMP '2024-11-06 00:00:00' AND stage = 'LEAD'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001051",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600....",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-12-09 00:00:00' AND created_ts <  TIMESTAMP '2024-12-24 00:00:00' AND resolved_ts IS NOT NULL AND category = 'MERCH'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001052",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-10-10 00:00:00' AND created_ts <  TIMESTAMP '2024-10-18 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001053",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-11-15 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-12-13 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001054",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "-- dashboard_extract: exec summary WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-09-23 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-10-08 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001055",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e001055"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e001055 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e001055 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-04 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e001055 LIMIT 500;"
  },
  {
    "sql_id": "S001056",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-12-04 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-12-04 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-12-19 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-12-04 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-12-19 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001057",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "-- dashboard_extract: exec summary WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchase...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-02-24 00:00:00' - INTERVAL '365 days')\n        AND purchased_at <  TIMESTAMP '2024-02-24 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-02-24 00:00:00' - INTERVAL '365 days')\n        AND order_ts <  TIMESTAMP '2024-02-24 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-02-24 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-02-24 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001058",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-11-08 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-11-08 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-11-19 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-11-08 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-11-19 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001059",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-25 00:00:00' AND event_ts <  TIMESTAMP '2024-12-03 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001060",
    "tables": [
      "crm_deals",
      "tmp_e001060"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "CREATE TEMP TABLE tmp_e001060 AS         SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals   ...",
    "sql_full": "CREATE TEMP TABLE tmp_e001060 AS\n        SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-01-13 00:00:00' AND created_ts <  TIMESTAMP '2024-01-24 00:00:00' AND stage = 'LOST'\n    GROUP BY 1,2\n    ORDER BY month, stage;\n        SELECT * FROM tmp_e001060 LIMIT 500;"
  },
  {
    "sql_id": "S001061",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e001061"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e001061 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e001061 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e001061 LIMIT 500;"
  },
  {
    "sql_id": "S001062",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001063",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "-- ad-hoc rerun WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM ra...",
    "sql_full": "-- ad-hoc rerun\nWITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-06-11 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-06-18 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001064",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-12-05 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001065",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-11-13 00:00:00' AND created_ts <  TIMESTAMP '2024-11-19 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001066",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-05-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-05-07 00:00:00' AND created_ts <  TIMESTAMP '2024-05-21 00:00:00' AND stage = 'PROPOSAL'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001067",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600....",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-08-17 00:00:00' AND created_ts <  TIMESTAMP '2024-08-20 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (-- sanity-check filters\nORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001068",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001069",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-05-03 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-05-10 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    -- sanity-check filters\nORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001070",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-10-05 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-10-16 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001071",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-05-29 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-05-29 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-06-04 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-05-29 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-06-04 00:00:00' + INTERVAL '3 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '3 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001072",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-04-09 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-04-23 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    -- sanity-check filters\nORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001073",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-06-24 00:00:00' AND event_ts <  TIMESTAMP '2024-07-29 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001074",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "-- ad-hoc rerun SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,...",
    "sql_full": "-- ad-hoc rerun\nSELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-11-01 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-11-29 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001075",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-08-30 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-05 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001076",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-02-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-02-17 00:00:00' AND created_ts <  TIMESTAMP '2024-02-24 00:00:00' AND stage = 'LOST'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001077",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-30 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001078",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-04 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001079",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-01-01 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-01-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-01-06 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-01-01 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-01-06 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001080",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHER...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-01-01 00:00:00' AND created_ts <  TIMESTAMP '2024-03-05 00:00:00' AND stage = 'PROPOSAL'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001081",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001082",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001083",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHER...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-04-18 00:00:00' AND created_ts <  TIMESTAMP '2024-04-25 00:00:00' AND stage = 'WON'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001084",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-03-02 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-03-09 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001085",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-06-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001086",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-11-08 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-11-08 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-11-19 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-11-08 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-11-19 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001087",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-28 00:00:00' AND event_ts <  TIMESTAMP '2024-11-30 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001088",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-04-29 00:00:00' AND event_ts <  TIMESTAMP '2024-05-14 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001089",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-09-04 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-09-04 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-25 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-09-04 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-09-25 00:00:00' + INTERVAL '3 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '3 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001090",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) A...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-12-10 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-12-31 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001091",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "-- ad-hoc rerun WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP ...",
    "sql_full": "-- ad-hoc rerun\nWITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-09-04 00:00:00' - INTERVAL '365 days')\n        AND purchased_at <  TIMESTAMP '2024-09-04 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-09-04 00:00:00' - INTERVAL '365 days')\n        AND order_ts <  TIMESTAMP '2024-09-04 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-09-04 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-09-04 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY customers DESC;"
  },
  {
    "sql_id": "S001092",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001093",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-04-05 00:00:00' AND created_ts <  TIMESTAMP '2024-04-16 00:00:00' AND resolved_ts IS NOT NULL AND category = 'ACCESS'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001094",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-03-25 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-04-05 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001095",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-03 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001096",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHER...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-03-27 00:00:00' AND created_ts <  TIMESTAMP '2024-03-29 00:00:00' AND stage = 'QUALIFIED'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001097",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-11-08 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-11-08 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-11-19 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-11-08 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-11-19 00:00:00' + INTERVAL '3 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '3 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001098",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e001098"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e001098 AS         -- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM...",
    "sql_full": "CREATE TEMP TABLE tmp_e001098 AS\n        -- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-13 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e001098 LIMIT 500;"
  },
  {
    "sql_id": "S001099",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-11 00:00:00' AND event_ts <  TIMESTAMP '2024-11-19 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001100",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-18 00:00:00' AND event_ts <  TIMESTAMP '2024-10-22 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001101",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-10-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-10-22 00:00:00' AND created_ts <  TIMESTAMP '2024-10-25 00:00:00' AND stage = 'LOST'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY month, stage;"
  },
  {
    "sql_id": "S001102",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-04 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001103",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-12-13 00:00:00' AND event_ts <  TIMESTAMP '2024-12-17 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001104",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001105",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001106",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-09-19 00:00:00'...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-09-19 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-25 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-09-19 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-09-25 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001107",
    "tables": [
      "raw_ticket_sales",
      "tmp_e001107"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "CREATE TEMP TABLE tmp_e001107 AS         SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 ...",
    "sql_full": "CREATE TEMP TABLE tmp_e001107 AS\n        SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-09-10 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-10-11 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;\n        SELECT * FROM tmp_e001107 LIMIT 500;"
  },
  {
    "sql_id": "S001108",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-05-05 00:00:00' AND event_ts <  TIMESTAMP '2024-05-07 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001109",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-27 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001110",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-04-25 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-04-25 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-05-10 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-04-25 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-05-10 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001111",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-19 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001112",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans",
      "tmp_e001112"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e001112 AS         -- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.ev...",
    "sql_full": "CREATE TEMP TABLE tmp_e001112 AS\n        -- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-12-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-21 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;\n        SELECT * FROM tmp_e001112 LIMIT 500;"
  },
  {
    "sql_id": "S001113",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-01-22 00:00:00' AND created_ts <  TIMESTAMP '2024-02-06 00:00:00' AND resolved_ts IS NOT NULL AND category = 'ACCESS'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001114",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-27 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-30 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001115",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-01 00:00:00' AND event_ts <  TIMESTAMP '2024-10-08 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001116",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-06-19 00:00:00' AND event_ts <  TIMESTAMP '2024-07-04 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001117",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-08-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001118",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-12-06 00:00:00' AND event_ts <  TIMESTAMP '2024-12-17 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001119",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-11-05 00:00:00' AND created_ts <  TIMESTAMP '2024-11-26 00:00:00' AND resolved_ts IS NOT NULL AND category = 'MERCH'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001120",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-05-30 00:00:00' AND created_ts <  TIMESTAMP '2024-06-13 00:00:00' AND resolved_ts IS NOT NULL AND category = 'MERCH'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001121",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-08-18 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-08-29 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001122",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "-- ad-hoc rerun WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM ra...",
    "sql_full": "-- ad-hoc rerun\nWITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-12-17 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-12-24 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001123",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "-- dashboard_extract: exec summary WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchase...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-01-30 00:00:00' - INTERVAL '180 days')\n        AND purchased_at <  TIMESTAMP '2024-01-30 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-01-30 00:00:00' - INTERVAL '180 days')\n        AND order_ts <  TIMESTAMP '2024-01-30 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-01-30 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-01-30 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001124",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001125",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-08 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001126",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001127",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-08-27 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001128",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001129",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001130",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans",
      "tmp_e001130"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e001130 AS         WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week ...",
    "sql_full": "CREATE TEMP TABLE tmp_e001130 AS\n        WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;\n        SELECT * FROM tmp_e001130 LIMIT 500;"
  },
  {
    "sql_id": "S001131",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-17 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001132",
    "tables": [
      "raw_ticket_sales",
      "tmp_e001132"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "CREATE TEMP TABLE tmp_e001132 AS         SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 ...",
    "sql_full": "CREATE TEMP TABLE tmp_e001132 AS\n        SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-07-11 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-08-01 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;\n        SELECT * FROM tmp_e001132 LIMIT 500;"
  },
  {
    "sql_id": "S001133",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-23 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-30 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001134",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "-- dashboard_extract: exec summary WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-06-07 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-06-14 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001135",
    "tables": [
      "support_tickets",
      "tmp_e001135"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "CREATE TEMP TABLE tmp_e001135 AS         -- dashboard_extract: exec summary WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH...",
    "sql_full": "CREATE TEMP TABLE tmp_e001135 AS\n        -- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-08-29 00:00:00' AND created_ts <  TIMESTAMP '2024-09-06 00:00:00' AND resolved_ts IS NOT NULL AND category = 'BILLING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;\n        SELECT * FROM tmp_e001135 LIMIT 500;"
  },
  {
    "sql_id": "S001136",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-12 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-27 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001137",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e001137"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e001137 AS         -- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM...",
    "sql_full": "CREATE TEMP TABLE tmp_e001137 AS\n        -- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-06 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e001137 LIMIT 500;"
  },
  {
    "sql_id": "S001138",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001139",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-02-02 00:00:00' AND created_ts <  TIMESTAMP '2024-02-13 00:00:00' AND resolved_ts IS NOT NULL AND category = 'SEATING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (-- sanity-check filters\nORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001140",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-10-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-10-01 00:00:00' AND created_ts <  TIMESTAMP '2024-10-03 00:00:00' AND stage = 'WON'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001141",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001142",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-08-18 00:00:00' AND created_ts <  TIMESTAMP '2024-08-25 00:00:00' AND resolved_ts IS NOT NULL AND category = 'BILLING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001143",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-11 00:00:00' AND event_ts <  TIMESTAMP '2024-10-22 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001144",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-31 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001145",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-22 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001146",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-09-15 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-09-15 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-21 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-09-15 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-09-21 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001147",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-03-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-03-13 00:00:00' AND created_ts <  TIMESTAMP '2024-03-27 00:00:00' AND stage = 'LOST'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001148",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-07-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-07-13 00:00:00' AND created_ts <  TIMESTAMP '2024-07-27 00:00:00' AND stage = 'PROPOSAL'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001149",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-10-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-10-08 00:00:00' AND created_ts <  TIMESTAMP '2024-10-15 00:00:00' AND stage = 'PROPOSAL'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001150",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-06 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001151",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "-- dashboard_extract: exec summary WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-12-13 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-12-17 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001152",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-11-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-11-27 00:00:00' AND created_ts <  TIMESTAMP '2024-12-03 00:00:00' AND stage = 'LEAD'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001153",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-07-01 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-07-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-03 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-07-01 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-09-03 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001154",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-12-04 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-12-07 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001155",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001156",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001157",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-10-08 00:00:00' AND created_ts <  TIMESTAMP '2024-10-15 00:00:00' AND resolved_ts IS NOT NULL AND category = 'SEATING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001158",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-02-25 00:00:00' AND created_ts <  TIMESTAMP '2024-02-27 00:00:00' AND resolved_ts IS NOT NULL AND category = 'SEATING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001159",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-09-08 00:00:00' AND created_ts <  TIMESTAMP '2024-09-11 00:00:00' AND resolved_ts IS NOT NULL AND category = 'SEATING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001160",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-08-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001161",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-11 00:00:00' AND event_ts <  TIMESTAMP '2024-11-19 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001162",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001163",
    "tables": [
      "raw_digital_events",
      "tmp_e001163"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e001163 AS         WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,        ...",
    "sql_full": "CREATE TEMP TABLE tmp_e001163 AS\n        WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-21 00:00:00' AND event_ts <  TIMESTAMP '2024-11-05 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;\n        SELECT * FROM tmp_e001163 LIMIT 500;"
  },
  {
    "sql_id": "S001164",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-05-15 00:00:00' AND created_ts <  TIMESTAMP '2024-05-30 00:00:00' AND resolved_ts IS NOT NULL AND category = 'SEATING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001165",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-05-04 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001166",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-10-28 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-10-28 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-11-05 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-10-28 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-11-05 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001167",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-10-22 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-29 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001168",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-05-27 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-11 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001169",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-02-15 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001170",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-11-23 00:00:00' AND created_ts <  TIMESTAMP '2024-11-26 00:00:00' AND resolved_ts IS NOT NULL AND category = 'MERCH'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (-- sanity-check filters\nORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001171",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e001171"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e001171 AS         -- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM...",
    "sql_full": "CREATE TEMP TABLE tmp_e001171 AS\n        -- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-28 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e001171 LIMIT 500;"
  },
  {
    "sql_id": "S001172",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-11-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-11-13 00:00:00' AND created_ts <  TIMESTAMP '2024-11-27 00:00:00' AND stage = 'PROPOSAL'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001173",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-12-27 00:00:00' AND event_ts <  TIMESTAMP '2024-12-31 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001174",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-29 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001175",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-02-08 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-02-22 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001176",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) A...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-07-09 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-07-30 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001177",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches",
      "tmp_e001177"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "CREATE TEMP TABLE tmp_e001177 AS         WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenu...",
    "sql_full": "CREATE TEMP TABLE tmp_e001177 AS\n        WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-03-03 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-03-06 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY attributed_net_revenue DESC;\n        SELECT * FROM tmp_e001177 LIMIT 500;"
  },
  {
    "sql_id": "S001178",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-06 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001179",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-21 00:00:00' AND event_ts <  TIMESTAMP '2024-11-23 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001180",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHER...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-09-03 00:00:00' AND created_ts <  TIMESTAMP '2024-09-18 00:00:00' AND stage = 'LEAD'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001181",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-06-22 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001182",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-05-26 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-05-29 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001183",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001184",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-19 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001185",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-12-16 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-12-23 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001186",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-13 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001187",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-09-20 00:00:00'...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-09-20 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-27 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-09-20 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-09-27 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001188",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-04-02 00:00:00' AND created_ts <  TIMESTAMP '2024-04-09 00:00:00' AND resolved_ts IS NOT NULL AND category = 'SEATING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001189",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-01-04 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-01-04 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-01-06 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-01-04 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-01-06 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001190",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-03-14 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-03-29 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001191",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-02-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001192",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-13 00:00:00' AND event_ts <  TIMESTAMP '2024-10-20 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001193",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600....",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-11-29 00:00:00' AND created_ts <  TIMESTAMP '2024-12-10 00:00:00' AND resolved_ts IS NOT NULL AND category = 'ACCESS'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001194",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "-- ad-hoc rerun WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM ra...",
    "sql_full": "-- ad-hoc rerun\nWITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-12-17 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-12-24 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001195",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-09 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001196",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-12-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-12-17 00:00:00' AND created_ts <  TIMESTAMP '2024-12-31 00:00:00' AND stage = 'LOST'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001197",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-07-18 00:00:00' AND created_ts <  TIMESTAMP '2024-07-20 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (-- sanity-check filters\nORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001198",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001199",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-11-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-11-09 00:00:00' AND created_ts <  TIMESTAMP '2024-11-13 00:00:00' AND stage = 'WON'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001200",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders",
      "tmp_e001200"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e001200 AS         WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-05-14 00:...",
    "sql_full": "CREATE TEMP TABLE tmp_e001200 AS\n        WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-05-14 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-05-21 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-05-14 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-05-21 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;\n        SELECT * FROM tmp_e001200 LIMIT 500;"
  },
  {
    "sql_id": "S001201",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-12-20 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-12-28 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001202",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001203",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600....",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-10-26 00:00:00' AND created_ts <  TIMESTAMP '2024-11-30 00:00:00' AND resolved_ts IS NOT NULL AND category = 'ACCESS'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001204",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-03-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-03-26 00:00:00' AND created_ts <  TIMESTAMP '2024-04-23 00:00:00' AND stage = 'PROPOSAL'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001205",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-08-27 00:00:00' AND event_ts <  TIMESTAMP '2024-09-24 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001206",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-11 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001207",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-14 00:00:00' AND event_ts <  TIMESTAMP '2024-09-21 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001208",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-10-17 00:00:00' AND created_ts <  TIMESTAMP '2024-11-01 00:00:00' AND resolved_ts IS NOT NULL AND category = 'ACCESS'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001209",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-03-27 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-03-27 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-03-30 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-03-27 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-03-30 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001210",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-14 00:00:00' AND event_ts <  TIMESTAMP '2024-09-28 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001211",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-05-29 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-06-01 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    -- sanity-check filters\nORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001212",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-12-19 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-12-27 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001213",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) A...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-02-26 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-03-11 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001214",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-03-25 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-04-09 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001215",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-03-19 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-04-16 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001216",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-09-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-09-27 00:00:00' AND created_ts <  TIMESTAMP '2024-10-08 00:00:00' AND stage = 'PROPOSAL'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001217",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001218",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-23 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-26 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001219",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001220",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-04-30 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-05-11 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001221",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001222",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-31 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001223",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-08-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-08-19 00:00:00' AND created_ts <  TIMESTAMP '2024-08-22 00:00:00' AND stage = 'QUALIFIED'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001224",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-28 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001225",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-12-05 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-12-05 00:00:00' - INTERVAL '180 days')\n        AND purchased_at <  TIMESTAMP '2024-12-05 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-12-05 00:00:00' - INTERVAL '180 days')\n        AND order_ts <  TIMESTAMP '2024-12-05 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-12-05 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-12-05 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001226",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-10-31 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-10-31 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-11-07 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-10-31 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-11-07 00:00:00' + INTERVAL '3 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '3 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001227",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-05-24 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-05-28 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001228",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-09 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001229",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-12-06 00:00:00' AND event_ts <  TIMESTAMP '2024-12-17 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001230",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-10-27 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-10-27 00:00:00' - INTERVAL '180 days')\n        AND purchased_at <  TIMESTAMP '2024-10-27 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-10-27 00:00:00' - INTERVAL '180 days')\n        AND order_ts <  TIMESTAMP '2024-10-27 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-10-27 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-10-27 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001231",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-06-20 00:00:00' AND event_ts <  TIMESTAMP '2024-07-01 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001232",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001233",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-01-09 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001234",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-05-09 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-05-24 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001235",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-11-28 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-11-30 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001236",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-08-15 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-08-17 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    -- sanity-check filters\nORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001237",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-07-28 00:00:00' AND created_ts <  TIMESTAMP '2024-07-30 00:00:00' AND resolved_ts IS NOT NULL AND category = 'BILLING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001238",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e001238"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e001238 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e001238 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e001238 LIMIT 500;"
  },
  {
    "sql_id": "S001239",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-04-25 00:00:00' AND event_ts <  TIMESTAMP '2024-05-09 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001240",
    "tables": [
      "support_tickets",
      "tmp_e001240"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "CREATE TEMP TABLE tmp_e001240 AS         WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) /...",
    "sql_full": "CREATE TEMP TABLE tmp_e001240 AS\n        WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-08-14 00:00:00' AND created_ts <  TIMESTAMP '2024-08-20 00:00:00' AND resolved_ts IS NOT NULL AND category = 'SEATING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;\n        SELECT * FROM tmp_e001240 LIMIT 500;"
  },
  {
    "sql_id": "S001241",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-10-20 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001242",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-21 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001243",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-05-16 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-06-06 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001244",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-03-22 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001245",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-01-23 00:00:00' AND event_ts <  TIMESTAMP '2024-01-30 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001246",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-03-12 00:00:00' AND event_ts <  TIMESTAMP '2024-03-19 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001247",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e001247"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e001247 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e001247 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-17 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e001247 LIMIT 500;"
  },
  {
    "sql_id": "S001248",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001249",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-07-30 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-07-30 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-08-13 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-07-30 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-08-13 00:00:00' + INTERVAL '3 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '3 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001250",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "-- ad-hoc rerun SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIM...",
    "sql_full": "-- ad-hoc rerun\nSELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-11-20 00:00:00' AND created_ts <  TIMESTAMP '2024-11-26 00:00:00' AND stage = 'LEAD'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001251",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-06-10 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-06-18 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001252",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-05-24 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-05-31 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001253",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-06 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001254",
    "tables": [
      "raw_digital_events",
      "tmp_e001254"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e001254 AS         WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,        ...",
    "sql_full": "CREATE TEMP TABLE tmp_e001254 AS\n        WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-01-01 00:00:00' AND event_ts <  TIMESTAMP '2024-01-10 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;\n        SELECT * FROM tmp_e001254 LIMIT 500;"
  },
  {
    "sql_id": "S001255",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-01 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001256",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600....",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-03-18 00:00:00' AND created_ts <  TIMESTAMP '2024-04-02 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001257",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-02-06 00:00:00'...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-02-06 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-02-27 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-02-06 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-02-27 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001258",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-02-01 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-02-01 00:00:00' - INTERVAL '90 days')\n        AND purchased_at <  TIMESTAMP '2024-02-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-02-01 00:00:00' - INTERVAL '90 days')\n        AND order_ts <  TIMESTAMP '2024-02-01 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-02-01 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-02-01 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001259",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "-- ad-hoc rerun WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP ...",
    "sql_full": "-- ad-hoc rerun\nWITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-11-26 00:00:00' - INTERVAL '365 days')\n        AND purchased_at <  TIMESTAMP '2024-11-26 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-11-26 00:00:00' - INTERVAL '365 days')\n        AND order_ts <  TIMESTAMP '2024-11-26 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-11-26 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-11-26 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001260",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-05-24 00:00:00' AND event_ts <  TIMESTAMP '2024-05-28 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001261",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-08-04 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001262",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-11-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-11-29 00:00:00' AND created_ts <  TIMESTAMP '2024-12-27 00:00:00' AND stage = 'LEAD'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001263",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-11-30 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-12-07 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001264",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-10-29 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-11-05 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001265",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-10-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001266",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001267",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e001267"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e001267 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e001267 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-27 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-05 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e001267 LIMIT 500;"
  },
  {
    "sql_id": "S001268",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "-- ad-hoc rerun WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM ra...",
    "sql_full": "-- ad-hoc rerun\nWITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-03-19 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-03-26 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001269",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "-- dashboard_extract: exec summary WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchase...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-11-27 00:00:00' - INTERVAL '90 days')\n        AND purchased_at <  TIMESTAMP '2024-11-27 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-11-27 00:00:00' - INTERVAL '90 days')\n        AND order_ts <  TIMESTAMP '2024-11-27 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-11-27 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-11-27 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001270",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-01-29 00:00:00' AND created_ts <  TIMESTAMP '2024-01-31 00:00:00' AND resolved_ts IS NOT NULL AND category = 'SEATING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001271",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-06-03 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-06-14 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001272",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-01-01 00:00:00' AND created_ts <  TIMESTAMP '2024-01-11 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001273",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-21 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001274",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-05-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001275",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-04-01 00:00:00' AND event_ts <  TIMESTAMP '2024-05-31 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001276",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001277",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders",
      "tmp_e001277"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "CREATE TEMP TABLE tmp_e001277 AS         WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE pu...",
    "sql_full": "CREATE TEMP TABLE tmp_e001277 AS\n        WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-08-08 00:00:00' - INTERVAL '90 days')\n        AND purchased_at <  TIMESTAMP '2024-08-08 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-08-08 00:00:00' - INTERVAL '90 days')\n        AND order_ts <  TIMESTAMP '2024-08-08 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-08-08 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-08-08 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;\n        SELECT * FROM tmp_e001277 LIMIT 500;"
  },
  {
    "sql_id": "S001278",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-06-03 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-06-14 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001279",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-31 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-14 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001280",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'US' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001281",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-07-26 00:00:00' AND created_ts <  TIMESTAMP '2024-08-09 00:00:00' AND resolved_ts IS NOT NULL AND category = 'SEATING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001282",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-10-12 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-10-12 00:00:00' - INTERVAL '90 days')\n        AND purchased_at <  TIMESTAMP '2024-10-12 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-10-12 00:00:00' - INTERVAL '90 days')\n        AND order_ts <  TIMESTAMP '2024-10-12 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-10-12 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-10-12 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001283",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-08-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-08-21 00:00:00' AND created_ts <  TIMESTAMP '2024-09-04 00:00:00' AND stage = 'LEAD'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001284",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-23 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-08 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001285",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-25 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-31 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001286",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-08-22 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-08-29 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001287",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-06-06 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-06-09 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001288",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-05-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-07 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001289",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001290",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans",
      "tmp_e001290"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e001290 AS         WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week ...",
    "sql_full": "CREATE TEMP TABLE tmp_e001290 AS\n        WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;\n        SELECT * FROM tmp_e001290 LIMIT 500;"
  },
  {
    "sql_id": "S001291",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-07-10 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-07-10 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-07-12 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-07-10 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-07-12 00:00:00' + INTERVAL '3 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '3 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001292",
    "tables": [
      "crm_deals",
      "tmp_e001292"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "CREATE TEMP TABLE tmp_e001292 AS         SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals   ...",
    "sql_full": "CREATE TEMP TABLE tmp_e001292 AS\n        SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-02-27 00:00:00' AND created_ts <  TIMESTAMP '2024-03-05 00:00:00' AND stage = 'QUALIFIED'\n    GROUP BY 1,2\n    ORDER BY month, stage;\n        SELECT * FROM tmp_e001292 LIMIT 500;"
  },
  {
    "sql_id": "S001293",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-03-31 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-04-11 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001294",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-09-25 00:00:00' AND created_ts <  TIMESTAMP '2024-10-23 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001295",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-02 00:00:00' AND event_ts <  TIMESTAMP '2024-09-17 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001296",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-10-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-10-19 00:00:00' AND created_ts <  TIMESTAMP '2024-10-22 00:00:00' AND stage = 'LOST'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY month, stage;"
  },
  {
    "sql_id": "S001297",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600....",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-02-07 00:00:00' AND created_ts <  TIMESTAMP '2024-02-13 00:00:00' AND resolved_ts IS NOT NULL AND category = 'ACCESS'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001298",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-13 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001299",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-03 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-17 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001300",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-06-18 00:00:00' AND created_ts <  TIMESTAMP '2024-06-25 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001301",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-04-01 00:00:00' AND event_ts <  TIMESTAMP '2024-04-12 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001302",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-11-05 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-11-20 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001303",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-02-08 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-02-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001304",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-01-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-01-01 00:00:00' AND created_ts <  TIMESTAMP '2024-01-12 00:00:00' AND stage = 'QUALIFIED'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001305",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-08-02 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-08-13 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001306",
    "tables": [
      "support_tickets",
      "tmp_e001306"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "CREATE TEMP TABLE tmp_e001306 AS         WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) /...",
    "sql_full": "CREATE TEMP TABLE tmp_e001306 AS\n        WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-11-20 00:00:00' AND created_ts <  TIMESTAMP '2024-11-27 00:00:00' AND resolved_ts IS NOT NULL AND category = 'MERCH'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;\n        SELECT * FROM tmp_e001306 LIMIT 500;"
  },
  {
    "sql_id": "S001307",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'US' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001308",
    "tables": [
      "raw_ticket_sales",
      "tmp_e001308"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "CREATE TEMP TABLE tmp_e001308 AS         SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 ...",
    "sql_full": "CREATE TEMP TABLE tmp_e001308 AS\n        SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-11-19 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-12-04 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;\n        SELECT * FROM tmp_e001308 LIMIT 500;"
  },
  {
    "sql_id": "S001309",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-01-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-01-01 00:00:00' AND created_ts <  TIMESTAMP '2024-01-16 00:00:00' AND stage = 'LEAD'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001310",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,     ...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-11 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001311",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-10-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001312",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-01 00:00:00' AND event_ts <  TIMESTAMP '2024-11-09 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001313",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-01-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-01-04 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001314",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-01 00:00:00' AND event_ts <  TIMESTAMP '2024-11-03 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001315",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-12-06 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-12-20 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001316",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001317",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-31 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-06 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001318",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-08-23 00:00:00' AND event_ts <  TIMESTAMP '2024-09-06 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001319",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-02-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-02-04 00:00:00' AND created_ts <  TIMESTAMP '2024-02-11 00:00:00' AND stage = 'QUALIFIED'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001320",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-09-23 00:00:00'...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-09-23 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-10-04 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-09-23 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-10-04 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001321",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "-- dashboard_extract: exec summary WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-08-23 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-03 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001322",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-12-18 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-12-18 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-12-24 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-12-18 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-12-24 00:00:00' + INTERVAL '3 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '3 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001323",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-06-25 00:00:00' AND event_ts <  TIMESTAMP '2024-07-03 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001324",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-02-03 00:00:00' AND created_ts <  TIMESTAMP '2024-02-09 00:00:00' AND resolved_ts IS NOT NULL AND category = 'MERCH'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001325",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-08-19 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-03 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001326",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-09-30 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-10-04 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001327",
    "tables": [
      "raw_digital_events",
      "tmp_e001327"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e001327 AS         WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,        ...",
    "sql_full": "CREATE TEMP TABLE tmp_e001327 AS\n        WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-08 00:00:00' AND event_ts <  TIMESTAMP '2024-11-15 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;\n        SELECT * FROM tmp_e001327 LIMIT 500;"
  },
  {
    "sql_id": "S001328",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-07-22 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-07-22 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-08-06 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-07-22 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-08-06 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001329",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-09-21 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-10-06 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    -- sanity-check filters\nORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001330",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'GB' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001331",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-07-03 00:00:00'...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-07-03 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-07-09 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-07-03 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-07-09 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001332",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-03-12 00:00:00' AND event_ts <  TIMESTAMP '2024-03-26 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001333",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-09 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'GB' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001334",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders",
      "tmp_e001334"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "CREATE TEMP TABLE tmp_e001334 AS         WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE pu...",
    "sql_full": "CREATE TEMP TABLE tmp_e001334 AS\n        WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-07-30 00:00:00' - INTERVAL '90 days')\n        AND purchased_at <  TIMESTAMP '2024-07-30 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-07-30 00:00:00' - INTERVAL '90 days')\n        AND order_ts <  TIMESTAMP '2024-07-30 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-07-30 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-07-30 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;\n        SELECT * FROM tmp_e001334 LIMIT 500;"
  },
  {
    "sql_id": "S001335",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-11-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-26 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001336",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-10-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-10-07 00:00:00' AND created_ts <  TIMESTAMP '2024-10-15 00:00:00' AND stage = 'PROPOSAL'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY month, stage;"
  },
  {
    "sql_id": "S001337",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001338",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-09-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-09-25 00:00:00' AND created_ts <  TIMESTAMP '2024-09-28 00:00:00' AND stage = 'WON'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001339",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-05-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-05-14 00:00:00' AND created_ts <  TIMESTAMP '2024-05-21 00:00:00' AND stage = 'WON'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001340",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-22 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-28 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001341",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-05-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-05-27 00:00:00' AND created_ts <  TIMESTAMP '2024-06-11 00:00:00' AND stage = 'QUALIFIED'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001342",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-06-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-06-06 00:00:00' AND created_ts <  TIMESTAMP '2024-06-14 00:00:00' AND stage = 'WON'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001343",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-10-01 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001344",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-04-01 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-05-17 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001345",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-08-07 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-08-07 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-08-14 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-08-07 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-08-14 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001346",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-09-29 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-09-29 00:00:00' - INTERVAL '180 days')\n        AND purchased_at <  TIMESTAMP '2024-09-29 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-09-29 00:00:00' - INTERVAL '180 days')\n        AND order_ts <  TIMESTAMP '2024-09-29 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-09-29 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-09-29 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001347",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "-- dashboard_extract: exec summary WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-11-06 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-11-12 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001348",
    "tables": [
      "raw_ticket_sales",
      "tmp_e001348"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "CREATE TEMP TABLE tmp_e001348 AS         SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 ...",
    "sql_full": "CREATE TEMP TABLE tmp_e001348 AS\n        SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-06-07 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-06-10 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;\n        SELECT * FROM tmp_e001348 LIMIT 500;"
  },
  {
    "sql_id": "S001349",
    "tables": [
      "crm_deals",
      "tmp_e001349"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "CREATE TEMP TABLE tmp_e001349 AS         SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals   ...",
    "sql_full": "CREATE TEMP TABLE tmp_e001349 AS\n        SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-04-04 00:00:00' AND created_ts <  TIMESTAMP '2024-04-11 00:00:00' AND stage = 'LOST'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY month, stage;\n        SELECT * FROM tmp_e001349 LIMIT 500;"
  },
  {
    "sql_id": "S001350",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-08-29 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-08-29 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-04 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-08-29 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-09-04 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001351",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-12-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-12-12 00:00:00' AND created_ts <  TIMESTAMP '2024-12-19 00:00:00' AND stage = 'LOST'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001352",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-06 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-21 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001353",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-01-12 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-01-19 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001354",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-12-09 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-12-12 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001355",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-06-08 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-06-08 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-06-15 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-06-08 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-06-15 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001356",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders",
      "tmp_e001356"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e001356 AS         WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-03-25 00:...",
    "sql_full": "CREATE TEMP TABLE tmp_e001356 AS\n        WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-03-25 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-05-17 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-03-25 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-05-17 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;\n        SELECT * FROM tmp_e001356 LIMIT 500;"
  },
  {
    "sql_id": "S001357",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001358",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-31 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-11-11 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001359",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001360",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-10-30 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-10-30 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-11-06 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-10-30 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-11-06 00:00:00' + INTERVAL '3 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '3 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001361",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-01-28 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-01-28 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-01-30 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-01-28 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-01-30 00:00:00' + INTERVAL '3 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '3 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001362",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600....",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-02-24 00:00:00' AND created_ts <  TIMESTAMP '2024-03-02 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001363",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-07-19 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-07-23 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001364",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-01-22 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-01-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001365",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-04-30 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-05-07 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001366",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-04-18 00:00:00' AND event_ts <  TIMESTAMP '2024-05-23 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001367",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-12-03 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-12-31 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001368",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-12-24 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-12-24 00:00:00' - INTERVAL '90 days')\n        AND purchased_at <  TIMESTAMP '2024-12-24 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-12-24 00:00:00' - INTERVAL '90 days')\n        AND order_ts <  TIMESTAMP '2024-12-24 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-12-24 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-12-24 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001369",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-07-25 00:00:00' AND event_ts <  TIMESTAMP '2024-07-27 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001370",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-11-09 00:00:00'...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-11-09 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-11-16 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-11-09 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-11-16 00:00:00' + INTERVAL '3 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '3 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001371",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-08-28 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-08-28 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-04 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-08-28 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-09-04 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001372",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-08-09 00:00:00' AND event_ts <  TIMESTAMP '2024-08-30 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001373",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e001373"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e001373 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e001373 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-28 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e001373 LIMIT 500;"
  },
  {
    "sql_id": "S001374",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "-- ad-hoc rerun SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIM...",
    "sql_full": "-- ad-hoc rerun\nSELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-08-21 00:00:00' AND created_ts <  TIMESTAMP '2024-09-04 00:00:00' AND stage = 'LEAD'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY month, stage;"
  },
  {
    "sql_id": "S001375",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-03-28 00:00:00' AND event_ts <  TIMESTAMP '2024-04-12 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001376",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-30 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001377",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-04-02 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-04-02 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-04-23 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-04-02 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-04-23 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001378",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-04-25 00:00:00' AND created_ts <  TIMESTAMP '2024-05-02 00:00:00' AND resolved_ts IS NOT NULL AND category = 'BILLING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001379",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-10-28 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-10-28 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-11-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-10-28 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-11-01 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001380",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-03-26 00:00:00' AND event_ts <  TIMESTAMP '2024-03-30 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001381",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-12-23 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-31 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001382",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-11-16 00:00:00' AND created_ts <  TIMESTAMP '2024-11-19 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001383",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-18 00:00:00' AND event_ts <  TIMESTAMP '2024-09-25 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001384",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-06-29 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-06-29 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-07-03 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-06-29 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-07-03 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001385",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-13 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-08-16 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001386",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "-- dashboard_extract: exec summary WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchase...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-09-26 00:00:00' - INTERVAL '365 days')\n        AND purchased_at <  TIMESTAMP '2024-09-26 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-09-26 00:00:00' - INTERVAL '365 days')\n        AND order_ts <  TIMESTAMP '2024-09-26 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-09-26 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-09-26 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001387",
    "tables": [
      "raw_digital_events",
      "tmp_e001387"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e001387 AS         WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,        ...",
    "sql_full": "CREATE TEMP TABLE tmp_e001387 AS\n        WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-02-20 00:00:00' AND event_ts <  TIMESTAMP '2024-03-06 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;\n        SELECT * FROM tmp_e001387 LIMIT 500;"
  },
  {
    "sql_id": "S001388",
    "tables": [
      "raw_ticket_sales",
      "tmp_e001388"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "CREATE TEMP TABLE tmp_e001388 AS         SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 ...",
    "sql_full": "CREATE TEMP TABLE tmp_e001388 AS\n        SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-01-10 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-01-13 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;\n        SELECT * FROM tmp_e001388 LIMIT 500;"
  },
  {
    "sql_id": "S001389",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-02-19 00:00:00' AND event_ts <  TIMESTAMP '2024-03-05 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001390",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) A...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-03-13 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-03-28 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001391",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-05-02 00:00:00' AND created_ts <  TIMESTAMP '2024-05-16 00:00:00' AND resolved_ts IS NOT NULL AND category = 'REFUND'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001392",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-01-10 00:00:00' AND event_ts <  TIMESTAMP '2024-01-17 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001393",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-05-31 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-05-31 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-06-15 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-05-31 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-06-15 00:00:00' + INTERVAL '3 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '3 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001394",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-09-09 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001395",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-23 00:00:00' AND event_ts <  TIMESTAMP '2024-10-30 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001396",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-12-15 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-19 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001397",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-05-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-05-29 00:00:00' AND created_ts <  TIMESTAMP '2024-05-31 00:00:00' AND stage = 'LOST'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001398",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-10-19 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001399",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHER...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-02-17 00:00:00' AND created_ts <  TIMESTAMP '2024-02-20 00:00:00' AND stage = 'QUALIFIED'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY month, stage;"
  },
  {
    "sql_id": "S001400",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "-- dashboard_extract: exec summary WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-08-15 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-12 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001401",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-05-16 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-05-16 00:00:00' - INTERVAL '90 days')\n        AND purchased_at <  TIMESTAMP '2024-05-16 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-05-16 00:00:00' - INTERVAL '90 days')\n        AND order_ts <  TIMESTAMP '2024-05-16 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-05-16 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-05-16 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001402",
    "tables": [
      "crm_deals",
      "tmp_e001402"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "CREATE TEMP TABLE tmp_e001402 AS         -- ad-hoc rerun SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     F...",
    "sql_full": "CREATE TEMP TABLE tmp_e001402 AS\n        -- ad-hoc rerun\nSELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-09-03 00:00:00' AND created_ts <  TIMESTAMP '2024-09-18 00:00:00' AND stage = 'LEAD'\n    GROUP BY 1,2\n    ORDER BY month, stage;\n        SELECT * FROM tmp_e001402 LIMIT 500;"
  },
  {
    "sql_id": "S001403",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHER...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-10-07 00:00:00' AND created_ts <  TIMESTAMP '2024-10-13 00:00:00' AND stage = 'QUALIFIED'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001404",
    "tables": [
      "raw_ticket_sales",
      "dim_customer",
      "tmp_e001404"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e001404 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue...",
    "sql_full": "CREATE TEMP TABLE tmp_e001404 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e001404 LIMIT 500;"
  },
  {
    "sql_id": "S001405",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-05-24 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-06-08 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001406",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-11-28 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-12-06 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001407",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-02-11 00:00:00' AND created_ts <  TIMESTAMP '2024-02-14 00:00:00' AND resolved_ts IS NOT NULL AND category = 'BILLING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001408",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-08-27 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-10 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001409",
    "tables": [
      "raw_digital_events",
      "tmp_e001409"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e001409 AS         WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,        ...",
    "sql_full": "CREATE TEMP TABLE tmp_e001409 AS\n        WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-06 00:00:00' AND event_ts <  TIMESTAMP '2024-09-10 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;\n        SELECT * FROM tmp_e001409 LIMIT 500;"
  },
  {
    "sql_id": "S001410",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-09-15 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-09-15 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-19 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-09-15 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-09-19 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001411",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-10-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-10-04 00:00:00' AND created_ts <  TIMESTAMP '2024-10-08 00:00:00' AND stage = 'LEAD'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001412",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-04-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-04-30 00:00:00' AND created_ts <  TIMESTAMP '2024-05-21 00:00:00' AND stage = 'LEAD'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001413",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "-- dashboard_extract: exec summary WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchase...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-09-14 00:00:00' - INTERVAL '180 days')\n        AND purchased_at <  TIMESTAMP '2024-09-14 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-09-14 00:00:00' - INTERVAL '180 days')\n        AND order_ts <  TIMESTAMP '2024-09-14 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-09-14 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-09-14 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001414",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-11-06 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-11-13 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    -- sanity-check filters\nORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001415",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-12-13 00:00:00' AND created_ts <  TIMESTAMP '2024-12-17 00:00:00' AND resolved_ts IS NOT NULL AND category = 'SEATING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001416",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-04-02 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-04-02 00:00:00' - INTERVAL '365 days')\n        AND purchased_at <  TIMESTAMP '2024-04-02 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-04-02 00:00:00' - INTERVAL '365 days')\n        AND order_ts <  TIMESTAMP '2024-04-02 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-04-02 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-04-02 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001417",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-10-11 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-10-11 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-10-18 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-10-11 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-10-18 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001418",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-03 00:00:00' AND event_ts <  TIMESTAMP '2024-09-18 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001419",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-12-04 00:00:00' AND event_ts <  TIMESTAMP '2024-12-07 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001420",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "-- dashboard_extract: exec summary WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-03-15 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-03-19 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001421",
    "tables": [
      "raw_digital_events",
      "tmp_e001421"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e001421 AS         WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,        ...",
    "sql_full": "CREATE TEMP TABLE tmp_e001421 AS\n        WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-09-03 00:00:00' AND event_ts <  TIMESTAMP '2024-09-05 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;\n        SELECT * FROM tmp_e001421 LIMIT 500;"
  },
  {
    "sql_id": "S001422",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-04-12 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-04-19 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001423",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-12-16 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-20 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001424",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-05-21 00:00:00' AND event_ts <  TIMESTAMP '2024-06-05 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001425",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-16 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-23 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'SG' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001426",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-07 00:00:00' AND event_ts <  TIMESTAMP '2024-11-13 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001427",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-12-27 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-31 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'SUITE'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001428",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-12-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-12-25 00:00:00' AND created_ts <  TIMESTAMP '2025-01-01 00:00:00' AND stage = 'LOST'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001429",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-10-02 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-10-16 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001430",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-11-02 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-11-02 00:00:00' - INTERVAL '180 days')\n        AND purchased_at <  TIMESTAMP '2024-11-02 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-11-02 00:00:00' - INTERVAL '180 days')\n        AND order_ts <  TIMESTAMP '2024-11-02 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-11-02 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-11-02 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001431",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-01-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-01-23 00:00:00' AND created_ts <  TIMESTAMP '2024-01-27 00:00:00' AND stage = 'PROPOSAL'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001432",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-10-08 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-12 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001433",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-12-02 00:00:00'...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-12-02 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-12-10 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-12-02 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-12-10 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001434",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-06-21 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-25 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001435",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-07-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-22 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001436",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-02-25 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-02-25 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-02-27 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-02-25 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-02-27 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001437",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-05-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-05-15 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '300'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001438",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-07-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-07-12 00:00:00' AND created_ts <  TIMESTAMP '2024-07-16 00:00:00' AND stage = 'QUALIFIED'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001439",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-27 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-03 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'BOX_OFFICE' AND c.country = 'SG' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001440",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-08-26 00:00:00' AND event_ts <  TIMESTAMP '2024-09-23 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001441",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-05-07 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-05-14 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001442",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-12-06 00:00:00' AND event_ts <  TIMESTAMP '2024-12-17 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001443",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-11-07 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-11-15 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001444",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-08-30 00:00:00' AND created_ts <  TIMESTAMP '2024-09-10 00:00:00' AND resolved_ts IS NOT NULL AND category = 'SEATING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (-- sanity-check filters\nORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001445",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-08-31 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-08-31 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-03 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-08-31 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-09-03 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001446",
    "tables": [
      "raw_digital_events",
      "tmp_e001446"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e001446 AS         -- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN...",
    "sql_full": "CREATE TEMP TABLE tmp_e001446 AS\n        -- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-26 00:00:00' AND event_ts <  TIMESTAMP '2024-11-06 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;\n        SELECT * FROM tmp_e001446 LIMIT 500;"
  },
  {
    "sql_id": "S001447",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer",
      "tmp_e001447"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "CREATE TEMP TABLE tmp_e001447 AS         SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amo...",
    "sql_full": "CREATE TEMP TABLE tmp_e001447 AS\n        SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-04-14 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-18 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'CORPORATE'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;\n        SELECT * FROM tmp_e001447 LIMIT 500;"
  },
  {
    "sql_id": "S001448",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-18 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001449",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-05-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-01 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'CA' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001450",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-11-18 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-11-18 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-11-29 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-11-18 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-11-29 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001451",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600....",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-11-28 00:00:00' AND created_ts <  TIMESTAMP '2024-12-26 00:00:00' AND resolved_ts IS NOT NULL AND category = 'MERCH'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001452",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-05-22 00:00:00' AND created_ts <  TIMESTAMP '2024-05-30 00:00:00' AND resolved_ts IS NOT NULL AND category = 'ACCESS'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001453",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-09-23 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-10-01 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001454",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-02-06 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-02-06 00:00:00' - INTERVAL '90 days')\n        AND purchased_at <  TIMESTAMP '2024-02-06 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-02-06 00:00:00' - INTERVAL '90 days')\n        AND order_ts <  TIMESTAMP '2024-02-06 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-02-06 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-02-06 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001455",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-09-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001456",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-11-27 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-12-04 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'US' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001457",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours       FROM su...",
    "sql_full": "WITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-09-15 00:00:00' AND created_ts <  TIMESTAMP '2024-09-18 00:00:00' AND resolved_ts IS NOT NULL AND category = 'SEATING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001458",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-01-30 00:00:00' AND event_ts <  TIMESTAMP '2024-02-20 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001459",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders",
      "tmp_e001459"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "CREATE TEMP TABLE tmp_e001459 AS         WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-07-24 00:...",
    "sql_full": "CREATE TEMP TABLE tmp_e001459 AS\n        WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-07-24 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-07-31 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-07-24 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-07-31 00:00:00' + INTERVAL '7 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '7 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;\n        SELECT * FROM tmp_e001459 LIMIT 500;"
  },
  {
    "sql_id": "S001460",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-04-02 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-30 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001461",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-24 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-30 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'CA' AND c.segment = 'NEW'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001462",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-10-07 00:00:00' AND event_ts <  TIMESTAMP '2024-10-22 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001463",
    "tables": [
      "raw_digital_events",
      "tmp_e001463"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e001463 AS         WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,        ...",
    "sql_full": "CREATE TEMP TABLE tmp_e001463 AS\n        WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-07-04 00:00:00' AND event_ts <  TIMESTAMP '2024-07-06 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;\n        SELECT * FROM tmp_e001463 LIMIT 500;"
  },
  {
    "sql_id": "S001464",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-02-14 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-02-21 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001465",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-10-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-10-01 00:00:00' AND created_ts <  TIMESTAMP '2024-12-18 00:00:00' AND stage = 'LEAD'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001466",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "-- dashboard_extract: exec summary WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(C...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-11-26 00:00:00' AND event_ts <  TIMESTAMP '2024-11-29 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001467",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-05-18 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-06-01 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001468",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-09-17 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-10-01 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '200'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001469",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-01-07 00:00:00' AND event_ts <  TIMESTAMP '2024-01-09 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001470",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "customers",
      "avg_value"
    ],
    "kpi_family": "Rfm Segmentation",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "rfm_segmentation",
    "sql_preview": "WITH activity AS (       SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value       FROM raw_ticket_sales       WHERE purchased_at >= (TIMESTAMP '2024-12-09 00:0...",
    "sql_full": "WITH activity AS (\n      SELECT customer_id, purchased_at AS ts, (face_value - COALESCE(discount_amount,0)) AS value\n      FROM raw_ticket_sales\n      WHERE purchased_at >= (TIMESTAMP '2024-12-09 00:00:00' - INTERVAL '90 days')\n        AND purchased_at <  TIMESTAMP '2024-12-09 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n      UNION ALL\n      SELECT customer_id, order_ts AS ts, (quantity * unit_price - COALESCE(discount_amount,0)) AS value\n      FROM raw_merch_orders\n      WHERE order_ts >= (TIMESTAMP '2024-12-09 00:00:00' - INTERVAL '90 days')\n        AND order_ts <  TIMESTAMP '2024-12-09 00:00:00'\n    ),\n    rfm AS (\n      SELECT\n        customer_id,\n        MAX(ts) AS last_activity_ts,\n        COUNT(*) AS txn_count,\n        SUM(value) AS total_value\n      FROM activity\n      GROUP BY 1\n    )\n    SELECT\n      CASE\n        WHEN (TIMESTAMP '2024-12-09 00:00:00' - last_activity_ts) <= INTERVAL '30 days' AND txn_count >= 5 THEN 'DIEHARD'\n        WHEN (TIMESTAMP '2024-12-09 00:00:00' - last_activity_ts) <= INTERVAL '90 days' AND txn_count >= 2 THEN 'ENGAGED'\n        WHEN txn_count = 1 THEN 'NEW'\n        ELSE 'LAPSED'\n      END AS rfm_segment,\n      COUNT(*) AS customers,\n      AVG(total_value) AS avg_value\n    FROM rfm\n    GROUP BY 1\n    ORDER BY customers DESC;"
  },
  {
    "sql_id": "S001471",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-10-05 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-10-05 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-10-08 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-10-05 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-10-08 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001472",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-03-12 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-03-26 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001473",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-11-05 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-11-20 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001474",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-09-01 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-09-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-07 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-09-01 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-09-07 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001475",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-11-19 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-11-25 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001476",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-07-19 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-07-19 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-07-26 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-07-19 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-07-26 00:00:00' + INTERVAL '14 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '14 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001477",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-03 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-09 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'APP' AND c.country = 'GB' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001478",
    "tables": [
      "raw_ticket_sales",
      "dim_customer"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,       SUM(face_value - COALESCE(discoun...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(face_value + COALESCE(fees,0) - COALESCE(discount_amount,0)) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM raw_ticket_sales t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-06-07 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-06-14 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'CA' AND c.segment = 'DIEHARD'\n    GROUP BY 1,2\n    -- sanity-check filters\nORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001479",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-12-14 00:00:00' AND event_ts <  TIMESTAMP '2024-12-17 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    -- sanity-check filters\nORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001480",
    "tables": [
      "support_tickets"
    ],
    "primary_table": "support_tickets",
    "kpis": [
      "resolved_tickets",
      "avg_resolution_hours",
      "p90_resolution_hours"
    ],
    "kpi_family": "Support Sla",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "support_sla",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         category,         status,         created_ts,         resolved_ts,         EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600....",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        category,\n        status,\n        created_ts,\n        resolved_ts,\n        EXTRACT(EPOCH FROM (resolved_ts - created_ts)) / 3600.0 AS resolution_hours\n      FROM support_tickets\n      WHERE created_ts >= TIMESTAMP '2024-06-16 00:00:00' AND created_ts <  TIMESTAMP '2024-06-18 00:00:00' AND resolved_ts IS NOT NULL AND category = 'BILLING'\n    )\n    SELECT\n      category,\n      COUNT(*) AS resolved_tickets,\n      AVG(resolution_hours) AS avg_resolution_hours,\n      PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY resolution_hours) AS p90_resolution_hours\n    FROM base\n    GROUP BY 1\n    ORDER BY resolved_tickets DESC;"
  },
  {
    "sql_id": "S001481",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "-- ad-hoc rerun SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,...",
    "sql_full": "-- ad-hoc rerun\nSELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-07-01 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-09-17 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001482",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-07-12 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-07-26 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001483",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-01-10 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-01-10 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-02-07 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-01-10 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-02-07 00:00:00' + INTERVAL '3 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '3 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  },
  {
    "sql_id": "S001484",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-02-03 00:00:00' AND event_ts <  TIMESTAMP '2024-02-24 00:00:00' AND device_type = 'TABLET'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001485",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-11-29 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-12-13 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001486",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,       COUNT(DISTI...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-03-26 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-04-02 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'WEB' AND c.country = 'GB' AND c.segment = 'CASUAL'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001487",
    "tables": [
      "raw_digital_events",
      "tmp_e001487"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "CREATE TEMP TABLE tmp_e001487 AS         WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,        ...",
    "sql_full": "CREATE TEMP TABLE tmp_e001487 AS\n        WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-01-26 00:00:00' AND event_ts <  TIMESTAMP '2024-01-30 00:00:00' AND device_type = 'MOBILE'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;\n        SELECT * FROM tmp_e001487 LIMIT 500;"
  },
  {
    "sql_id": "S001488",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-12-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-12-20 00:00:00' AND created_ts <  TIMESTAMP '2024-12-24 00:00:00' AND stage = 'LOST'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001489",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       FROM raw_ticket_sales t       JOIN ...",
    "sql_full": "WITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-03-22 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-29 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = 'CLUB'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001490",
    "tables": [
      "crm_deals"
    ],
    "primary_table": "crm_deals",
    "kpis": [
      "deals_created",
      "pipeline_amount"
    ],
    "kpi_family": "Deals Pipeline",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "deals_pipeline",
    "sql_preview": "SELECT       DATE_TRUNC('month', created_ts) AS month,       stage,       COUNT(*) AS deals_created,       SUM(amount) AS pipeline_amount     FROM crm_deals     WHERE created_ts >= TIMESTAMP '2024-07-...",
    "sql_full": "SELECT\n      DATE_TRUNC('month', created_ts) AS month,\n      stage,\n      COUNT(*) AS deals_created,\n      SUM(amount) AS pipeline_amount\n    FROM crm_deals\n    WHERE created_ts >= TIMESTAMP '2024-07-13 00:00:00' AND created_ts <  TIMESTAMP '2024-07-20 00:00:00' AND stage = 'QUALIFIED'\n    GROUP BY 1,2\n    ORDER BY month, stage;"
  },
  {
    "sql_id": "S001491",
    "tables": [
      "raw_digital_events"
    ],
    "primary_table": "raw_digital_events",
    "kpis": [
      "sessions",
      "sessions_with_purchase",
      "session_conversion_rate"
    ],
    "kpi_family": "Campaign Funnel",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "campaign_funnel",
    "sql_preview": "WITH sessions AS (       SELECT         campaign_id,         session_id,         MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,         MAX(CASE WHEN event_type = 'CHECKOUT_STA...",
    "sql_full": "WITH sessions AS (\n      SELECT\n        campaign_id,\n        session_id,\n        MAX(CASE WHEN event_type = 'PAGE_VIEW' THEN 1 ELSE 0 END) AS saw_page,\n        MAX(CASE WHEN event_type = 'CHECKOUT_START' THEN 1 ELSE 0 END) AS started_checkout,\n        MAX(CASE WHEN event_type = 'PURCHASE' THEN 1 ELSE 0 END) AS purchased\n      FROM raw_digital_events\n      WHERE event_ts >= TIMESTAMP '2024-01-01 00:00:00' AND event_ts <  TIMESTAMP '2024-01-13 00:00:00' AND device_type = 'DESKTOP'\n      GROUP BY 1,2\n    )\n    SELECT\n      campaign_id,\n      COUNT(*) AS sessions,\n      SUM(saw_page) AS sessions_with_page,\n      SUM(started_checkout) AS sessions_with_checkout,\n      SUM(purchased) AS sessions_with_purchase,\n      (SUM(purchased)::numeric / NULLIF(COUNT(*),0)) AS session_conversion_rate\n    FROM sessions\n    GROUP BY 1\n    ORDER BY sessions DESC;"
  },
  {
    "sql_id": "S001492",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-03-29 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-04-02 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001493",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-10-01 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-11-15 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001494",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-10-08 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-11-05 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    -- sanity-check filters\nORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001495",
    "tables": [
      "raw_ticket_sales",
      "marketing_touches"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "attributed_tickets",
      "attributed_net_revenue"
    ],
    "kpi_family": "Marketing Last Touch",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "marketing_last_touch",
    "sql_preview": "WITH purchases AS (       SELECT         customer_id,         ticket_id,         purchased_at,         (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees       FROM raw_ticket_sales  ...",
    "sql_full": "WITH purchases AS (\n      SELECT\n        customer_id,\n        ticket_id,\n        purchased_at,\n        (face_value - COALESCE(discount_amount,0)) AS net_revenue_excl_fees\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-07-01 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-09-22 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    last_touch AS (\n      SELECT\n        p.ticket_id,\n        MAX(t.touch_ts) AS last_touch_ts\n      FROM purchases p\n      JOIN marketing_touches t\n        ON t.customer_id = p.customer_id\n       AND CAST(t.touch_ts AS DATE) <= CAST(p.purchased_at AS DATE)\n      GROUP BY 1\n    )\n    SELECT\n      mt.campaign_id,\n      COUNT(DISTINCT p.ticket_id) AS attributed_tickets,\n      SUM(p.net_revenue_excl_fees) AS attributed_net_revenue\n    FROM purchases p\n    JOIN last_touch lt ON lt.ticket_id = p.ticket_id\n    JOIN marketing_touches mt\n      ON mt.customer_id = p.customer_id\n     AND mt.touch_ts = lt.last_touch_ts\n    GROUP BY 1\n    ORDER BY attributed_net_revenue DESC;"
  },
  {
    "sql_id": "S001496",
    "tables": [
      "analytics.vw_ticket_sales_enriched",
      "dim_customer"
    ],
    "primary_table": "analytics.vw_ticket_sales_enriched",
    "kpis": [
      "gross_revenue",
      "net_revenue",
      "tickets_sold"
    ],
    "kpi_family": "Ticket Revenue Daily",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "ticket_revenue_daily",
    "sql_preview": "SELECT       DATE_TRUNC('day', t.purchased_at) AS day,       t.channel,       SUM(gross_revenue) AS gross_revenue,       SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', t.purchased_at) AS day,\n      t.channel,\n      SUM(gross_revenue) AS gross_revenue,\n      SUM(face_value - COALESCE(discount_amount,0) + COALESCE(fees,0)) AS net_revenue,\n      COUNT(DISTINCT t.ticket_id) AS tickets_sold\n    FROM analytics.vw_ticket_sales_enriched t\n    JOIN dim_customer c ON c.customer_id = t.customer_id\n    WHERE t.purchased_at >= TIMESTAMP '2024-07-17 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-07-24 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.channel = 'PARTNER' AND c.country = 'SG' AND c.segment = 'FAMILY'\n    GROUP BY 1,2\n    ORDER BY day, t.channel;"
  },
  {
    "sql_id": "S001497",
    "tables": [
      "raw_ticket_sales",
      "dim_event",
      "raw_attendance_scans"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "attended",
      "attendance_rate"
    ],
    "kpi_family": "Attendance Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attendance_rate",
    "sql_preview": "-- dashboard_extract: exec summary WITH base AS (       SELECT         t.ticket_id,         t.event_id,         t.seat_section,         DATE_TRUNC('week', e.event_date::timestamp) AS event_week       ...",
    "sql_full": "-- dashboard_extract: exec summary\nWITH base AS (\n      SELECT\n        t.ticket_id,\n        t.event_id,\n        t.seat_section,\n        DATE_TRUNC('week', e.event_date::timestamp) AS event_week\n      FROM raw_ticket_sales t\n      JOIN dim_event e ON e.event_id = t.event_id\n      WHERE t.purchased_at >= TIMESTAMP '2024-03-10 00:00:00' AND t.purchased_at <  TIMESTAMP '2024-03-21 00:00:00' AND COALESCE(t.refunded_flag,false) = false AND t.seat_section = '100'\n    ),\n    scans AS (\n      SELECT DISTINCT ticket_id, 1 AS attended_flag\n      FROM raw_attendance_scans\n      WHERE scanned_at IS NOT NULL\n    )\n    SELECT\n      b.event_week,\n      b.seat_section,\n      COUNT(DISTINCT b.ticket_id) AS tickets,\n      SUM(COALESCE(s.attended_flag,0)) AS attended,\n      (SUM(COALESCE(s.attended_flag,0))::numeric / NULLIF(COUNT(DISTINCT b.ticket_id),0)) AS attendance_rate\n    FROM base b\n    LEFT JOIN scans s ON s.ticket_id = b.ticket_id\n    GROUP BY 1,2\n    ORDER BY b.event_week, b.seat_section;"
  },
  {
    "sql_id": "S001498",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "-- dashboard_extract: exec summary SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) A...",
    "sql_full": "-- dashboard_extract: exec summary\nSELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-06-16 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-06-19 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001499",
    "tables": [
      "raw_ticket_sales"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets",
      "refunded_tickets",
      "refund_rate"
    ],
    "kpi_family": "Refund Spike",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "refund_spike",
    "sql_preview": "SELECT       DATE_TRUNC('day', purchased_at) AS day,       channel,       COUNT(*) AS tickets,       SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,       (SUM(CASE...",
    "sql_full": "SELECT\n      DATE_TRUNC('day', purchased_at) AS day,\n      channel,\n      COUNT(*) AS tickets,\n      SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END) AS refunded_tickets,\n      (SUM(CASE WHEN COALESCE(refunded_flag,false) THEN 1 ELSE 0 END)::numeric / NULLIF(COUNT(*),0)) AS refund_rate\n    FROM raw_ticket_sales\n    WHERE purchased_at >= TIMESTAMP '2024-12-10 00:00:00'\n      AND purchased_at <  TIMESTAMP '2024-12-17 00:00:00'\n    GROUP BY 1,2\n    HAVING COUNT(*) >= 50\n    ORDER BY refund_rate DESC, tickets DESC;"
  },
  {
    "sql_id": "S001500",
    "tables": [
      "raw_ticket_sales",
      "raw_merch_orders"
    ],
    "primary_table": "raw_ticket_sales",
    "kpis": [
      "tickets_sold",
      "tickets_with_merch",
      "merch_attach_rate"
    ],
    "kpi_family": "Attach Rate",
    "frequency": 1,
    "frequency_bucket": "Low (<5)",
    "archetype": "attach_rate",
    "sql_preview": "WITH tickets AS (       SELECT customer_id, ticket_id, purchased_at, event_id       FROM raw_ticket_sales       WHERE purchased_at >= TIMESTAMP '2024-10-08 00:00:00'         AND purchased_at <  TIMEST...",
    "sql_full": "WITH tickets AS (\n      SELECT customer_id, ticket_id, purchased_at, event_id\n      FROM raw_ticket_sales\n      WHERE purchased_at >= TIMESTAMP '2024-10-08 00:00:00'\n        AND purchased_at <  TIMESTAMP '2024-10-16 00:00:00'\n        AND COALESCE(refunded_flag,false) = false\n    ),\n    merch AS (\n      SELECT customer_id, order_id, order_ts\n      FROM raw_merch_orders\n      WHERE order_ts >= TIMESTAMP '2024-10-08 00:00:00'\n        AND order_ts <  (TIMESTAMP '2024-10-16 00:00:00' + INTERVAL '3 days')\n    ),\n    attached AS (\n      SELECT DISTINCT t.ticket_id\n      FROM tickets t\n      JOIN merch m\n        ON m.customer_id = t.customer_id\n       AND m.order_ts >= t.purchased_at\n       AND m.order_ts <  (t.purchased_at + INTERVAL '3 days')\n    )\n    SELECT\n      COUNT(DISTINCT tickets.ticket_id) AS tickets_sold,\n      COUNT(DISTINCT attached.ticket_id) AS tickets_with_merch,\n      (COUNT(DISTINCT attached.ticket_id)::numeric / NULLIF(COUNT(DISTINCT tickets.ticket_id),0)) AS merch_attach_rate\n    FROM tickets\n    LEFT JOIN attached ON attached.ticket_id = tickets.ticket_id;"
  }
]