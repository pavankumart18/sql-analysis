# SQL Query Universe - SandDance Style Visualization

## Overview

This is a SandDance-inspired interactive visualization that displays **all ~1,500 SQL queries** as persistent dots that smoothly rearrange when encodings change.

## Key Principles

### 1. All Dots Always Visible
- **NO filtering** - all 1,500 queries are always displayed
- Dots never disappear, they only rearrange
- Uses `key: {field: 'sql_id'}` to preserve dot identity

### 2. Smooth Animations
- 500ms transitions when encodings change
- Dots smoothly move from old positions to new positions
- Color changes animate smoothly
- Powered by Vega-Lite's automatic transition system

### 3. Dense, "Alive" Visualization
- Small square marks (20px) create dense visual field
- All dots visible simultaneously
- Overlapping dots maintain visibility (opacity: 0.8)

## Files

- `index.html` - Main HTML structure with Vega-Lite CDN
- `index.js` - Vega-Lite specifications and interaction logic
- `style.css` - SandDance-inspired dark theme styling
- `sql_universe.csv` - Data file (generated by `generate_sql_universe.py`)

## How to Use

1. **Generate data** (if needed):
   ```bash
   python generate_sql_universe.py
   ```

2. **Open in browser**:
   - Simply open `index.html` in a web browser
   - No server required - works as static files
   - For local file access, you may need to serve via HTTP (e.g., `python -m http.server`)

3. **Interact with visualization**:
   - **Color Encoding**: Change what colors represent (frequency_bucket, kpi_family, primary_table)
   - **Layout**: Switch between Scatter, Grid, or Facet views
   - **Sort**: Reorder dots by execution_count or num_kpis

## Technical Details

### Why Dots Never Disappear

1. **No Filter Transforms**: The Vega-Lite spec never uses `filter` transforms
2. **All Data Always Included**: The data array always contains all 1,500 rows
3. **Layout Changes Only**: When you change layout, dots rearrange but none are removed
4. **Bin Transforms**: Grid layout uses `bin` encoding to group dots into cells, but all dots remain visible
5. **Facet Layout**: Facet creates separate panels, but shows all dots across panels

### How Animation Works

1. **Identity Preservation**: Each dot has `key: {field: 'sql_id'}` in the encoding
2. **Automatic Matching**: When the spec changes, Vega-Lite matches dots by their key
3. **Smooth Interpolation**: Vega runtime interpolates position and color changes
4. **500ms Duration**: Transitions complete in 500ms for smooth, responsive feel

### Layout Types

- **Scatter**: X = num_tables_used, Y = execution_count
  - All dots positioned by these exact values
  - No binning or grouping

- **Grid**: Binned num_tables_used Ã— binned num_kpis
  - Uses `bin` encoding to create grid cells
  - Dots group into bins but all remain visible

- **Facet**: Grouped by primary_table
  - Creates separate panels for each primary_table
  - All dots visible across all panels

## Data Schema

Each row in `sql_universe.csv` represents one unique `sql_id`:

- `sql_id` - Unique identifier (stable key)
- `num_tables_used` - Number of tables in query
- `num_kpis` - Number of KPIs calculated
- `primary_table` - Most frequently used table
- `kpi_family` - Query archetype/category
- `execution_count` - Number of times executed
- `frequency_bucket` - daily/weekly/monthly/ad-hoc
- `analyst` - Analyst who created query
- `dominant_hour` - Most common execution hour
- `dominant_day_of_week` - Most common execution day

## Browser Compatibility

- Modern browsers with ES6+ support
- Requires fetch API for CSV loading
- Vega-Lite v5 via CDN

## Performance

- Handles 1,500 dots smoothly
- SVG rendering for crisp visuals
- Efficient updates via Vega's optimized rendering

